{% extends "base.html" %} {% block content %}
<div class="auth-container">
  <div class="auth-card">
    <h2 class="auth-title">Join ShadowTalk</h2>

    {% if error %}
    <div class="alert alert-error">{{ error }}</div>
    {% endif %}

    <form method="POST" class="auth-form" id="registerForm">
      <div class="form-group">
        <label for="email">Email</label>
        <input
          type="email"
          id="email"
          name="email"
          required
          class="form-input"
          placeholder="Enter your email"
        />
      </div>

      <div class="form-group">
        <label for="password">Password</label>
        <div class="password-input-container">
          <input
            type="password"
            id="password"
            name="password"
            required
            class="form-input"
            placeholder="Create a password"
            oninput="checkPasswordStrength(this.value)"
          />
          <button
            type="button"
            class="toggle-password"
            aria-label="Show password"
          >
            <i class="fas fa-eye"></i>
          </button>
        </div>
        <div class="password-strength-container">
          <div class="password-strength-meter">
            <div class="strength-bar"></div>
          </div>
          <div class="password-strength-text"></div>
        </div>
        <div class="password-requirements">
          <ul>
            <li id="req-length" class="requirement-unmet">
              <i class="fas fa-times"></i>
              At least 8 characters
            </li>
            <li id="req-lowercase" class="requirement-unmet">
              <i class="fas fa-times"></i>
              One lowercase letter
            </li>
            <li id="req-uppercase" class="requirement-unmet">
              <i class="fas fa-times"></i>
              One uppercase letter
            </li>
            <li id="req-number" class="requirement-unmet">
              <i class="fas fa-times"></i>
              One number
            </li>
            <li id="req-special" class="requirement-unmet">
              <i class="fas fa-times"></i>
              One special character
            </li>
          </ul>
        </div>
      </div>

      <div class="form-group">
        <label for="confirm_password">Confirm Password</label>
        <div class="password-input-container">
          <input
            type="password"
            id="confirm_password"
            name="confirm_password"
            required
            class="form-input"
            placeholder="Confirm your password"
            oninput="checkPasswordMatch()"
          />
          <button
            type="button"
            class="toggle-password"
            aria-label="Show password"
          >
            <i class="fas fa-eye"></i>
          </button>
        </div>
        <div class="password-match-feedback"></div>
      </div>

      <!-- Terms and Conditions Checkbox -->
      <div class="form-group checkbox-group">
        <input
          type="checkbox"
          id="terms"
          name="terms"
          required
          class="form-checkbox"
        />
        <label for="terms" class="checkbox-label">
          I agree to the
          <a href="#" class="terms-link" data-modal="terms-modal"
            >Terms and Conditions</a
          >
          and
          <a href="#" class="terms-link" data-modal="privacy-modal"
            >Privacy Policy</a
          >
        </label>
      </div>

      <button type="submit" class="btn-primary btn-full" id="submitBtn">
        Register
      </button>
    </form>

    <div class="auth-links">
      <a href="{{ url_for('login') }}">Already have an account? Login</a>
    </div>
  </div>
</div>

<!-- Terms and Conditions Modal -->
<div id="terms-modal" class="modal">
  <div class="modal-content">
    <div class="modal-header">
      <h3>Terms and Conditions</h3>
      <span class="close-modal">&times;</span>
    </div>
    <div class="modal-body">
      <h4>Welcome to ShadowTalk</h4>
      <p>
        By using our service, you agree to the following terms and conditions:
      </p>

      <h5>1. Account Registration</h5>
      <p>
        You must provide accurate and complete information when creating an
        account. You are responsible for maintaining the confidentiality of your
        account credentials.
      </p>

      <h5>2. User Conduct</h5>
      <p>
        You agree not to use ShadowTalk for any unlawful purpose or in any way
        that could damage, disable, or impair our service.
      </p>

      <h5>3. Content</h5>
      <p>
        You retain ownership of any content you post, but grant us a license to
        display and distribute that content through our service.
      </p>

      <h5>4. Termination</h5>
      <p>
        We reserve the right to suspend or terminate your account if you violate
        these terms.
      </p>

      <p>
        These terms may be updated from time to time. Continued use of the
        service constitutes acceptance of any changes.
      </p>
    </div>
    <div class="modal-footer">
      <button class="btn-secondary close-modal-btn">Close</button>
    </div>
  </div>
</div>

<!-- Privacy Policy Modal -->
<div id="privacy-modal" class="modal">
  <div class="modal-content">
    <div class="modal-header">
      <h3>Privacy Policy</h3>
      <span class="close-modal">&times;</span>
    </div>
    <div class="modal-body">
      <h4>Your Privacy Matters</h4>
      <p>
        This Privacy Policy explains how we collect, use, and protect your
        personal information.
      </p>

      <h5>1. Information We Collect</h5>
      <p>
        We collect information you provide directly to us, such as when you
        create an account, including your email address and any content you
        post.
      </p>

      <h5>2. How We Use Your Information</h5>
      <p>
        We use your information to provide, maintain, and improve our services,
        communicate with you, and ensure the security of our platform.
      </p>

      <h5>3. Information Sharing</h5>
      <p>
        We do not sell your personal information. We may share information in
        limited circumstances, such as to comply with legal requirements.
      </p>

      <h5>4. Data Security</h5>
      <p>
        We implement appropriate security measures to protect your personal
        information from unauthorized access.
      </p>

      <h5>5. Your Rights</h5>
      <p>
        You may access, correct, or delete your personal information through
        your account settings or by contacting us.
      </p>
    </div>
    <div class="modal-footer">
      <button class="btn-secondary close-modal-btn">Close</button>
    </div>
  </div>
</div>
{% endblock %} {% block extra_js %}
<script>
  // Modal functionality
  document.addEventListener("DOMContentLoaded", function () {
    // Get modal elements
    const modals = document.querySelectorAll(".modal");
    const termsLinks = document.querySelectorAll(".terms-link");
    const closeButtons = document.querySelectorAll(
      ".close-modal, .close-modal-btn"
    );

    // Open modal when terms link is clicked
    termsLinks.forEach((link) => {
      link.addEventListener("click", function (e) {
        e.preventDefault();
        const modalId = this.getAttribute("data-modal");
        const modal = document.getElementById(modalId);
        if (modal) {
          modal.style.display = "block";
        }
      });
    });

    // Close modal when close button is clicked
    closeButtons.forEach((button) => {
      button.addEventListener("click", function () {
        modals.forEach((modal) => {
          modal.style.display = "none";
        });
      });
    });

    // Close modal when clicking outside the modal content
    window.addEventListener("click", function (e) {
      modals.forEach((modal) => {
        if (e.target === modal) {
          modal.style.display = "none";
        }
      });
    });
  });

  function checkPasswordStrength(password) {
    let strength = 0;
    const requirements = {
      length: false,
      lowercase: false,
      uppercase: false,
      number: false,
      special: false,
    };

    // Check length
    if (password.length >= 8) {
      strength++;
      requirements.length = true;
      updateRequirement("length", true);
    } else {
      updateRequirement("length", false);
    }

    // Check lowercase
    if (/[a-z]/.test(password)) {
      strength++;
      requirements.lowercase = true;
      updateRequirement("lowercase", true);
    } else {
      updateRequirement("lowercase", false);
    }

    // Check uppercase
    if (/[A-Z]/.test(password)) {
      strength++;
      requirements.uppercase = true;
      updateRequirement("uppercase", true);
    } else {
      updateRequirement("uppercase", false);
    }

    // Check numbers
    if (/[0-9]/.test(password)) {
      strength++;
      requirements.number = true;
      updateRequirement("number", true);
    } else {
      updateRequirement("number", false);
    }

    // Check special characters
    if (/[^A-Za-z0-9]/.test(password)) {
      strength++;
      requirements.special = true;
      updateRequirement("special", true);
    } else {
      updateRequirement("special", false);
    }

    updateStrengthMeter(strength, requirements);
    checkPasswordMatch();
  }

  function updateRequirement(type, met) {
    const element = document.getElementById(`req-${type}`);
    const icon = element.querySelector("i");

    if (met) {
      element.classList.remove("requirement-unmet");
      element.classList.add("requirement-met");
      icon.classList.remove("fa-times");
      icon.classList.add("fa-check");
    } else {
      element.classList.remove("requirement-met");
      element.classList.add("requirement-unmet");
      icon.classList.remove("fa-check");
      icon.classList.add("fa-times");
    }
  }

  function updateStrengthMeter(strength, requirements) {
    const meter = document.querySelector(".strength-bar");
    const text = document.querySelector(".password-strength-text");
    const submitBtn = document.getElementById("submitBtn");
    const termsCheckbox = document.getElementById("terms");

    let strengthText = "";
    let strengthColor = "";
    let width = "0%";
    let isStrongEnough = false;

    switch (strength) {
      case 0:
        strengthText = "Very Weak";
        strengthColor = "#ef4444";
        width = "20%";
        break;
      case 1:
        strengthText = "Weak";
        strengthColor = "#f97316";
        width = "40%";
        break;
      case 2:
        strengthText = "Fair";
        strengthColor = "#eab308";
        width = "60%";
        break;
      case 3:
        strengthText = "Good";
        strengthColor = "#84cc16";
        width = "80%";
        break;
      case 4:
        strengthText = "Strong";
        strengthColor = "#22c55e";
        width = "95%";
        isStrongEnough = true;
        break;
      case 5:
        strengthText = "Very Strong";
        strengthColor = "#10b981";
        width = "100%";
        isStrongEnough = true;
        break;
    }

    meter.style.width = width;
    meter.style.backgroundColor = strengthColor;
    text.textContent = `Password Strength: ${strengthText}`;
    text.style.color = strengthColor;

    // Update submit button state based on password strength, match, and terms agreement
    const password = document.getElementById("password").value;
    const confirmPassword = document.getElementById("confirm_password").value;
    const passwordsMatch = password === confirmPassword && password !== "";
    const termsAgreed = termsCheckbox.checked;

    if (isStrongEnough && passwordsMatch && termsAgreed) {
      submitBtn.disabled = false;
      submitBtn.title = "";
    } else {
      submitBtn.disabled = true;
      if (!isStrongEnough) {
        submitBtn.title = 'Password must be at least "Strong" to register';
      } else if (!passwordsMatch) {
        submitBtn.title = "Passwords must match";
      } else {
        submitBtn.title =
          "You must agree to the Terms and Conditions and Privacy Policy";
      }
    }
  }

  function checkPasswordMatch() {
    const password = document.getElementById("password").value;
    const confirmPassword = document.getElementById("confirm_password").value;
    const feedback = document.querySelector(".password-match-feedback");
    const submitBtn = document.getElementById("submitBtn");

    if (confirmPassword === "") {
      feedback.textContent = "";
      feedback.className = "password-match-feedback";
      return;
    }

    if (password === confirmPassword) {
      feedback.textContent = "✓ Passwords match";
      feedback.className = "password-match-feedback match";
    } else {
      feedback.textContent = "✗ Passwords do not match";
      feedback.className = "password-match-feedback no-match";
    }

    // Re-check strength to update submit button
    checkPasswordStrength(password);
  }

  // Initialize form validation
  document.addEventListener("DOMContentLoaded", function () {
    const form = document.getElementById("registerForm");
    const passwordInput = document.getElementById("password");
    const confirmInput = document.getElementById("confirm_password");
    const termsCheckbox = document.getElementById("terms");

    // Add event listener to terms checkbox to update submit button state
    termsCheckbox.addEventListener("change", function () {
      checkPasswordStrength(passwordInput.value);
    });

    form.addEventListener("submit", function (e) {
      const password = passwordInput.value;
      const confirmPassword = confirmInput.value;

      // Final validation
      if (password !== confirmPassword) {
        e.preventDefault();
        toastr.error("Passwords do not match");
        return;
      }

      // Check password strength requirements
      const strength = calculatePasswordStrength(password);
      if (strength < 4) {
        // Require at least "Strong" password
        e.preventDefault();
        toastr.error(
          "Password is not strong enough. Please ensure it meets all requirements."
        );
        return;
      }

      // Check terms agreement
      if (!termsCheckbox.checked) {
        e.preventDefault();
        toastr.error(
          "You must agree to the Terms and Conditions and Privacy Policy"
        );
        return;
      }
    });

    // Initial state
    updateStrengthMeter(0, {
      length: false,
      lowercase: false,
      uppercase: false,
      number: false,
      special: false,
    });
  });

  function calculatePasswordStrength(password) {
    let strength = 0;
    if (password.length >= 8) strength++;
    if (/[a-z]/.test(password)) strength++;
    if (/[A-Z]/.test(password)) strength++;
    if (/[0-9]/.test(password)) strength++;
    if (/[^A-Za-z0-9]/.test(password)) strength++;
    return strength;
  }
</script>

<style>
  /* Modal Styles */
  .modal {
    display: none;
    position: fixed;
    z-index: 1000;
    left: 0;
    top: 0;
    width: 100%;
    height: 100%;
    background-color: rgba(0, 0, 0, 0.5);
  }

  .modal-content {
    background-color: #fff;
    margin: 5% auto;
    padding: 0;
    border-radius: 8px;
    width: 80%;
    max-width: 600px;
    max-height: 80vh;
    overflow-y: auto;
    box-shadow: 0 4px 20px rgba(0, 0, 0, 0.15);
  }

  .modal-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 16px 24px;
    border-bottom: 1px solid #e5e5e5;
    background-color: #f9fafb;
    border-radius: 8px 8px 0 0;
  }

  .modal-header h3 {
    margin: 0;
    font-size: 1.25rem;
    color: #1f2937;
  }

  .close-modal {
    font-size: 1.5rem;
    font-weight: bold;
    cursor: pointer;
    color: #6b7280;
  }

  .close-modal:hover {
    color: #374151;
  }

  .modal-body {
    padding: 24px;
    color: #4b5563;
  }

  .modal-body h4 {
    margin-top: 0;
    color: #1f2937;
  }

  .modal-body h5 {
    margin-top: 1.5rem;
    margin-bottom: 0.5rem;
    color: #1f2937;
  }

  .modal-body p {
    margin-bottom: 1rem;
    line-height: 1.6;
  }

  .modal-footer {
    padding: 16px 24px;
    border-top: 1px solid #e5e5e5;
    display: flex;
    justify-content: flex-end;
    background-color: #f9fafb;
    border-radius: 0 0 8px 8px;
  }

  /* Terms and Conditions Checkbox Styles */
  .checkbox-group {
    display: flex;
    align-items: flex-start;
    margin-bottom: 1.5rem;
  }

  .form-checkbox {
    margin-right: 10px;
    margin-top: 3px;
  }

  .checkbox-label {
    font-size: 0.9rem;
    line-height: 1.4;
    color: #4b5563;
  }

  .terms-link {
    color: #3b82f6;
    text-decoration: none;
  }

  .terms-link:hover {
    text-decoration: underline;
  }
</style>
{% endblock %}
