{% extends "base.html" %} {% block content %}
<div class="setup-container">
  <!-- Progress Bar -->
  <div class="setup-progress">
    <div class="progress-bar">
      <div class="progress-fill" id="progressFill"></div>
    </div>
    <div class="progress-steps">
      <span class="step active" data-step="1">Basic Info</span>
      <span class="step" data-step="2">Avatar</span>
      <span class="step" data-step="3">Interests</span>
      <span class="step" data-step="4">Preview</span>
    </div>
  </div>

  <div class="setup-content">
    <!-- Step 1: Basic Information -->
    <div class="setup-step active" id="step1">
      <div class="setup-header">
        <h2 class="setup-title">Welcome to ShadowTalk! üëã</h2>
        <p class="setup-subtitle">
          Let's create your amazing profile. We'll help you every step of the
          way.
        </p>
      </div>

      <form method="POST" class="setup-form" id="profileForm">
        <div class="form-grid">
          <div class="form-group">
            <label for="display_name" class="form-label">
              Display Name
              <span
                class="tooltip-icon"
                data-tooltip="This is how other users will see you"
                >‚ÑπÔ∏è</span
              >
            </label>
            <input
              type="text"
              id="display_name"
              name="display_name"
              required
              class="form-input"
              placeholder="Enter your display name"
              oninput="updatePreview()"
            />
            <div class="input-feedback" id="nameFeedback"></div>
          </div>

          <div class="form-group">
            <label for="username" class="form-label">
              Username
              <span
                class="tooltip-icon"
                data-tooltip="Your unique identifier on the platform"
                >‚ÑπÔ∏è</span
              >
            </label>
            <input
              type="text"
              id="username"
              name="username"
              required
              class="form-input"
              placeholder="Choose a username"
              oninput="checkUsernameAvailability()"
            />
            <div class="input-feedback" id="usernameFeedback"></div>
          </div>
        </div>

        <div class="form-grid">
          <div class="form-group">
            <label for="age" class="form-label">Age</label>
            <input
              type="number"
              id="age"
              name="age"
              min="13"
              max="100"
              class="form-input"
              oninput="updatePreview()"
            />
          </div>

          <div class="form-group">
            <label for="gender" class="form-label">Gender</label>
            <select
              id="gender"
              name="gender"
              class="form-input"
              onchange="updatePreview()"
            >
              <option value="">Prefer not to say</option>
              <option value="male">Male</option>
              <option value="female">Female</option>
              <option value="non-binary">Non-binary</option>
              <option value="other">Other</option>
            </select>
          </div>
        </div>

        <div class="form-group">
          <label for="bio" class="form-label">
            Bio
            <span
              class="tooltip-icon"
              data-tooltip="Share a bit about yourself to help others get to know you"
              >‚ÑπÔ∏è</span
            >
          </label>
          <textarea
            id="bio"
            name="bio"
            class="form-input"
            rows="3"
            placeholder="Tell us about yourself, your interests, or what you're looking for..."
            oninput="updatePreview()"
          ></textarea>
          <div class="char-counter">
            <span id="charCount">0</span>/200 characters
          </div>
        </div>

        <div class="step-actions">
          <button type="button" class="btn-secondary" onclick="nextStep()">
            Continue to Avatar <i class="fas fa-arrow-right"></i>
          </button>
        </div>
      </form>
    </div>

    <!-- Step 2: Avatar Setup -->
    <div class="setup-step" id="step2">
      <div class="setup-header">
        <h2 class="setup-title">Create Your Avatar üé®</h2>
        <p class="setup-subtitle">
          Choose or create an avatar that represents you
        </p>
      </div>

      <div class="avatar-section">
        <div class="avatar-options">
          <!-- AI Avatar Generator -->
          <div class="avatar-option active" id="aiAvatarOption">
            <div class="option-header">
              <h4>AI Avatar Generator</h4>
              <span class="badge">Recommended</span>
            </div>
            <div class="avatar-preview-container">
              <div class="avatar-preview" id="aiAvatarPreview">
                <canvas id="avatarCanvas" width="200" height="200"></canvas>
                <div
                  class="avatar-initials-fallback"
                  id="avatarInitialsFallback"
                  style="display: none"
                >
                  <span id="avatarInitials">U</span>
                </div>
              </div>
              <div class="avatar-controls">
                <div class="control-group">
                  <label>Style:</label>
                  <select id="avatarStyle" onchange="generateAvatar()">
                    <option value="adventurer">Adventurer</option>
                    <option value="pixel">Pixel Art</option>
                    <option value="bottts">Robot</option>
                    <option value="identicon">Abstract</option>
                    <option value="avataaars">Cartoon</option>
                  </select>
                </div>
                <div class="control-group">
                  <label>Background:</label>
                  <input
                    type="color"
                    id="avatarBgColor"
                    value="#8b5cf6"
                    onchange="generateAvatar()"
                  />
                </div>
                <div class="control-group">
                  <label>Mood:</label>
                  <select id="avatarMood" onchange="generateAvatar()">
                    <option value="happy">üòä Happy</option>
                    <option value="neutral">üòê Neutral</option>
                    <option value="serious">üò† Serious</option>
                    <option value="fun">üòé Cool</option>
                  </select>
                </div>
              </div>
            </div>
            <button class="btn-primary" onclick="generateAvatar()">
              <i class="fas fa-sync-alt"></i> Regenerate
            </button>
            <button
              type="button"
              class="btn-secondary"
              onclick="useInitialsAvatar()"
            >
              <i class="fas fa-user-circle"></i> Use Initials Instead
            </button>
          </div>

          <!-- Photo Upload Option -->
          <div class="avatar-option" id="photoUploadOption">
            <div class="option-header">
              <h4>Upload Photo</h4>
            </div>
            <div class="upload-area" id="uploadArea">
              <i class="fas fa-cloud-upload-alt"></i>
              <p>Drag & drop your photo here</p>
              <span>or</span>
              <input
                type="file"
                id="photoUpload"
                accept="image/*"
                style="display: none"
              />
              <button
                class="btn-secondary"
                onclick="document.getElementById('photoUpload').click()"
              >
                Choose File
              </button>
            </div>
            <div class="ai-suggestion" id="aiSuggestion" style="display: none">
              <h5>AI Avatar Suggestions</h5>
              <div class="suggestion-grid" id="suggestionGrid">
                <!-- AI suggestions will be generated here -->
              </div>
            </div>
          </div>
        </div>

        <div class="step-actions">
          <button type="button" class="btn-secondary" onclick="prevStep()">
            <i class="fas fa-arrow-left"></i> Back
          </button>
          <button type="button" class="btn-primary" onclick="nextStep()">
            Continue to Interests <i class="fas fa-arrow-right"></i>
          </button>
        </div>
      </div>
    </div>

    <!-- Step 3: Interests -->
    <div class="setup-step" id="step3">
      <div class="setup-header">
        <h2 class="setup-title">Choose Your Interests üåü</h2>
        <p class="setup-subtitle">
          Select interests to get better matches (choose at least 3)
        </p>
        <div class="interests-counter">
          <span id="selectedCount">0</span>/3 selected
        </div>
      </div>

      <div class="interests-section">
        <!-- Smart Suggestions -->
        <div class="smart-suggestions">
          <h4>AI Suggestions Based on Your Profile</h4>
          <div class="suggested-interests" id="suggestedInterests">
            <!-- AI-suggested interests will appear here -->
          </div>
        </div>

        <!-- Trending Interests -->
        <div class="trending-interests">
          <h4>Trending Now üî•</h4>
          <div class="trending-tags" id="trendingTags">
            <!-- Trending interests will be loaded here -->
          </div>
        </div>

        <!-- All Interests Grid -->
        <div class="interests-grid-container">
          <div class="search-box">
            <i class="fas fa-search"></i>
            <input
              type="text"
              id="interestSearch"
              placeholder="Search interests..."
            />
          </div>
          <div class="interests-grid" id="interestsGrid">
            {% set interests = ['Technology', 'Music', 'Sports', 'Gaming',
            'Movies', 'Books', 'Travel', 'Food', 'Art', 'Science', 'Fitness',
            'Fashion', 'Photography', 'Nature', 'Business', 'Programming', 'AI',
            'Blockchain', 'Startups', 'Psychology', 'Philosophy', 'History',
            'Politics', 'Environment', 'Space', 'Robotics', 'VR/AR',
            'Cryptocurrency', 'Digital Art', 'Podcasts', 'Yoga', 'Meditation',
            'Cooking', 'Baking', 'Gardening', 'Anime', 'Manga', 'Comics', 'Board
            Games', 'Chess', 'Cryptography', 'Cybersecurity', 'Data Science'] %}
            {% for interest in interests %}
            <label class="interest-checkbox">
              <input
                type="checkbox"
                name="interests"
                value="{{ interest }}"
                onchange="updateInterestsCount()"
              />
              <span class="interest-tag">{{ interest }}</span>
            </label>
            {% endfor %}
          </div>
        </div>
      </div>

      <div class="step-actions">
        <button type="button" class="btn-secondary" onclick="prevStep()">
          <i class="fas fa-arrow-left"></i> Back
        </button>
        <button
          type="button"
          class="btn-primary"
          id="continueToPreview"
          onclick="nextStep()"
          disabled
        >
          Continue to Preview <i class="fas fa-arrow-right"></i>
        </button>
      </div>
    </div>

    <!-- Step 4: Preview & Complete -->
    <div class="setup-step" id="step4">
      <div class="setup-header">
        <h2 class="setup-title">Almost Done! üéâ</h2>
        <p class="setup-subtitle">
          Review your profile before completing setup
        </p>
      </div>

      <div class="preview-section">
        <div class="profile-preview">
          <div class="preview-header">
            <div class="preview-avatar">
              <img
                id="previewAvatar"
                src=""
                alt="Profile Avatar"
                style="display: none"
              />
              <div class="avatar-initials-fallback" id="previewAvatarInitials">
                <span id="previewAvatarInitialsText">U</span>
              </div>
            </div>
            <div class="preview-info">
              <h3 id="previewName">Display Name</h3>
              <p id="previewUsername">@username</p>
              <p class="preview-bio" id="previewBio">Bio will appear here...</p>
              <div class="preview-stats">
                <div class="stat">
                  <span class="stat-number" id="previewInterestsCount">0</span>
                  <span class="stat-label">Interests</span>
                </div>
                <div class="stat">
                  <span class="stat-number" id="previewAge">--</span>
                  <span class="stat-label">Age</span>
                </div>
              </div>
            </div>
          </div>

          <div class="preview-interests" id="previewInterests">
            <!-- Selected interests will appear here -->
          </div>

          <div class="compatibility-preview">
            <h4>Estimated Match Compatibility</h4>
            <div class="compatibility-score">
              <div class="score-circle">
                <span id="compatibilityScore">85%</span>
              </div>
              <p>Based on your interests and profile completeness</p>
            </div>
          </div>
        </div>

        <div class="setup-complete">
          <div class="completion-animation">
            <i class="fas fa-check-circle"></i>
          </div>
          <h3>Ready to Start Chatting!</h3>
          <p>Your profile is complete and optimized for great matches</p>
        </div>
      </div>

      <div class="step-actions">
        <button type="button" class="btn-secondary" onclick="prevStep()">
          <i class="fas fa-arrow-left"></i> Back
        </button>
        <button
          type="submit"
          class="btn-primary btn-complete"
          form="profileForm"
        >
          Complete Profile & Start Chatting <i class="fas fa-rocket"></i>
        </button>
      </div>
    </div>
  </div>
</div>

<!-- Guided Tour Modal -->
<div id="guidedTour" class="modal">
  <div class="modal-content tour-modal">
    <div class="tour-content">
      <div class="tour-step active" id="tourStep1">
        <h3>Welcome to Profile Setup! üéØ</h3>
        <p>
          We'll guide you through creating an amazing profile that helps you
          find great matches.
        </p>
        <div class="tour-actions">
          <button class="btn-primary" onclick="nextTourStep()">
            Let's Start!
          </button>
          <button class="btn-secondary" onclick="skipTour()">Skip Tour</button>
        </div>
      </div>
      <div class="tour-step" id="tourStep2">
        <h3>Your Display Identity üë§</h3>
        <p>
          Choose a display name and username that represent you. This is how
          others will see you.
        </p>
        <div class="tour-actions">
          <button class="btn-secondary" onclick="prevTourStep()">Back</button>
          <button class="btn-primary" onclick="nextTourStep()">Next</button>
        </div>
      </div>
      <div class="tour-step" id="tourStep3">
        <h3>Create Your Avatar üé®</h3>
        <p>
          Use our AI avatar generator or upload a photo. Your avatar helps
          others recognize you.
        </p>
        <div class="tour-actions">
          <button class="btn-secondary" onclick="prevTourStep()">Back</button>
          <button class="btn-primary" onclick="nextTourStep()">Next</button>
        </div>
      </div>
      <div class="tour-step" id="tourStep4">
        <h3>Share Your Interests üåü</h3>
        <p>
          Select interests to get matched with like-minded people. Choose at
          least 3 for best results.
        </p>
        <div class="tour-actions">
          <button class="btn-secondary" onclick="prevTourStep()">Back</button>
          <button class="btn-primary" onclick="completeTour()">Got It!</button>
        </div>
      </div>
    </div>
  </div>
</div>

<style>
  /* Enhanced Setup Styles - Mobile First Approach */
  .setup-container {
    max-width: 1000px;
    margin: 0 auto;
    padding: 15px;
    min-height: 100vh;
    background: #0a0a0f;
  }

  /* Progress Bar - Mobile Optimized */
  .setup-progress {
    margin-bottom: 30px;
  }

  .progress-bar {
    height: 6px;
    background: #2d2d42;
    border-radius: 3px;
    margin-bottom: 15px;
    overflow: hidden;
  }

  .progress-fill {
    height: 100%;
    background: linear-gradient(90deg, #6366f1, #3b82f6);
    border-radius: 3px;
    transition: width 0.5s ease;
    width: 25%;
  }

  .progress-steps {
    display: flex;
    justify-content: space-between;
    position: relative;
    flex-wrap: wrap;
    gap: 10px;
  }

  .progress-steps::before {
    content: "";
    position: absolute;
    top: 50%;
    left: 0;
    right: 0;
    height: 2px;
    background: #2d2d42;
    z-index: 1;
  }

  .step {
    position: relative;
    z-index: 2;
    background: #1a1a2e;
    padding: 8px 12px;
    border-radius: 20px;
    color: #888;
    font-weight: 500;
    transition: all 0.3s ease;
    border: 1px solid rgba(99, 102, 241, 0.2);
    font-size: 0.85rem;
    flex: 1;
    text-align: center;
    min-width: 0;
    overflow: hidden;
    text-overflow: ellipsis;
    white-space: nowrap;
  }

  .step.active {
    background: #6366f1;
    color: white;
  }

  /* Setup Steps */
  .setup-content {
    background: #1a1a2e;
    border-radius: 15px;
    padding: 20px;
    border: 1px solid rgba(99, 102, 241, 0.2);
  }

  .setup-step {
    display: none;
  }

  .setup-step.active {
    display: block;
    animation: fadeInUp 0.5s ease;
  }

  .setup-header {
    text-align: center;
    margin-bottom: 30px;
  }

  .setup-title {
    font-size: 1.8rem;
    margin-bottom: 10px;
    background: linear-gradient(135deg, #6366f1, #3b82f6);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    line-height: 1.2;
  }

  .setup-subtitle {
    color: #ccc;
    font-size: 1rem;
    line-height: 1.4;
  }

  /* Form Styles - Mobile Optimized */
  .form-grid {
    display: flex;
    flex-direction: column;
    gap: 15px;
    margin-bottom: 15px;
  }

  .form-group {
    margin-bottom: 20px;
  }

  .form-label {
    display: flex;
    align-items: center;
    gap: 8px;
    margin-bottom: 8px;
    font-weight: 600;
    color: #e0e0e0;
    font-size: 0.95rem;
  }

  .tooltip-icon {
    cursor: help;
    font-size: 0.8em;
    position: relative;
  }

  .tooltip-icon:hover::after {
    content: attr(data-tooltip);
    position: absolute;
    bottom: 100%;
    left: 50%;
    transform: translateX(-50%);
    background: #2d2d42;
    color: white;
    padding: 8px 12px;
    border-radius: 6px;
    font-size: 12px;
    white-space: nowrap;
    z-index: 1000;
    border: 1px solid rgba(99, 102, 241, 0.2);
  }

  .form-input {
    width: 100%;
    padding: 14px 16px;
    background: #2d2d42;
    border: 2px solid #555;
    border-radius: 10px;
    color: white;
    font-size: 16px; /* Prevents zoom on iOS */
    transition: all 0.3s ease;
    box-sizing: border-box;
    -webkit-appearance: none; /* Remove default styling on iOS */
  }

  .form-input:focus {
    border-color: #6366f1;
    outline: none;
    box-shadow: 0 0 0 3px rgba(99, 102, 241, 0.1);
  }

  .input-feedback {
    margin-top: 5px;
    font-size: 14px;
    min-height: 20px;
  }

  .char-counter {
    text-align: right;
    font-size: 12px;
    color: #888;
    margin-top: 5px;
  }

  /* Avatar Section - Mobile Optimized */
  .avatar-options {
    display: flex;
    flex-direction: column;
    gap: 20px;
    margin-bottom: 25px;
  }

  .avatar-option {
    background: #2d2d42;
    border: 2px solid #555;
    border-radius: 12px;
    padding: 20px;
    transition: all 0.3s ease;
  }

  .avatar-option.active {
    border-color: #6366f1;
    background: rgba(99, 102, 241, 0.05);
  }

  .option-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 15px;
  }

  .badge {
    background: #06d6a0;
    color: white;
    padding: 4px 8px;
    border-radius: 12px;
    font-size: 12px;
    font-weight: bold;
  }

  .avatar-preview-container {
    text-align: center;
    margin-bottom: 15px;
  }

  .avatar-preview {
    position: relative;
    width: 150px;
    height: 150px;
    margin: 0 auto 15px;
    border-radius: 50%;
    overflow: hidden;
    border: 4px solid #6366f1;
    background: #0a0a0f;
  }

  .avatar-preview canvas {
    position: relative;
    z-index: 2;
    max-width: 100%;
    height: auto;
  }

  /* Avatar Initials Styles */
  .avatar-initials-fallback {
    width: 100%;
    height: 100%;
    border-radius: 50%;
    background: linear-gradient(135deg, #6366f1, #3b82f6);
    display: flex;
    align-items: center;
    justify-content: center;
    color: white;
    font-size: 3em;
    font-weight: bold;
    text-transform: uppercase;
    position: absolute;
    top: 0;
    left: 0;
    z-index: 1;
  }

  .avatar-controls {
    display: flex;
    flex-direction: column;
    gap: 12px;
    margin-bottom: 15px;
  }

  .control-group {
    display: flex;
    justify-content: space-between;
    align-items: center;
  }

  .control-group label {
    color: #e0e0e0;
    font-weight: 500;
    font-size: 0.9rem;
  }

  .upload-area {
    border: 2px dashed #555;
    border-radius: 10px;
    padding: 30px 15px;
    text-align: center;
    cursor: pointer;
    transition: all 0.3s ease;
    margin-bottom: 15px;
    background: #2d2d42;
  }

  .upload-area:hover {
    border-color: #6366f1;
    background: rgba(99, 102, 241, 0.05);
  }

  .upload-area i {
    font-size: 36px;
    color: #6366f1;
    margin-bottom: 10px;
  }

  .ai-suggestion {
    margin-top: 15px;
    padding-top: 15px;
    border-top: 1px solid #555;
  }

  .suggestion-grid {
    display: grid;
    grid-template-columns: repeat(2, 1fr);
    gap: 8px;
    margin-top: 10px;
  }

  .suggestion-item {
    cursor: pointer;
    border-radius: 8px;
    overflow: hidden;
    transition: transform 0.3s ease;
    background: #2d2d42;
    padding: 8px;
    text-align: center;
  }

  .suggestion-item:hover {
    transform: scale(1.05);
    border: 1px solid #6366f1;
  }

  /* Interests Section - Mobile Optimized */
  .interests-counter {
    text-align: center;
    margin: 12px 0;
    font-size: 1rem;
    color: #6366f1;
    font-weight: bold;
  }

  .smart-suggestions,
  .trending-interests {
    margin-bottom: 20px;
    padding: 15px;
    background: #2d2d42;
    border-radius: 10px;
    border: 1px solid rgba(99, 102, 241, 0.2);
  }

  .smart-suggestions h4,
  .trending-interests h4 {
    margin-bottom: 12px;
    color: #6366f1;
    font-size: 1.1rem;
  }

  .suggested-interests,
  .trending-tags {
    display: flex;
    flex-wrap: wrap;
    gap: 8px;
  }

  .interests-grid-container {
    background: #2d2d42;
    border-radius: 10px;
    padding: 15px;
    border: 1px solid rgba(99, 102, 241, 0.2);
  }

  .search-box {
    position: relative;
    margin-bottom: 15px;
  }

  .search-box i {
    position: absolute;
    left: 15px;
    top: 50%;
    transform: translateY(-50%);
    color: #888;
  }

  .search-box input {
    width: 100%;
    padding: 12px 12px 12px 45px;
    background: #1a1a2e;
    border: 2px solid #555;
    border-radius: 8px;
    color: white;
    font-size: 16px;
    box-sizing: border-box;
  }

  .interests-grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(140px, 1fr));
    gap: 10px;
    max-height: 300px;
    overflow-y: auto;
    padding: 10px;
    background: #1a1a2e;
    border-radius: 8px;
  }

  .interest-checkbox {
    cursor: pointer;
  }

  .interest-checkbox input {
    display: none;
  }

  .interest-tag {
    display: block;
    padding: 12px 15px;
    background: #1a1a2e;
    border: 2px solid #555;
    border-radius: 25px;
    text-align: center;
    transition: all 0.3s ease;
    color: #ccc;
    font-size: 0.9rem;
    min-height: 44px; /* Minimum touch target size */
    display: flex;
    align-items: center;
    justify-content: center;
  }

  .interest-checkbox input:checked + .interest-tag {
    background: #6366f1;
    border-color: #6366f1;
    color: white;
    transform: scale(1.05);
  }

  /* Preview Section - Mobile Optimized */
  .preview-section {
    display: flex;
    flex-direction: column;
    gap: 25px;
  }

  .profile-preview {
    background: #2d2d42;
    border-radius: 12px;
    padding: 20px;
    border: 1px solid rgba(99, 102, 241, 0.2);
  }

  .preview-header {
    display: flex;
    flex-direction: column;
    gap: 15px;
    margin-bottom: 20px;
    text-align: center;
  }

  .preview-avatar {
    position: relative;
    width: 80px;
    height: 80px;
    margin: 0 auto;
  }

  .preview-avatar img {
    width: 100%;
    height: 100%;
    border-radius: 50%;
    object-fit: cover;
    border: 3px solid #6366f1;
  }

  .preview-info h3 {
    margin: 0 0 5px 0;
    color: #e0e0e0;
    font-size: 1.3rem;
  }

  .preview-username {
    color: #6366f1;
    margin: 0 0 8px 0;
  }

  .preview-bio {
    color: #ccc;
    margin: 10px 0;
    line-height: 1.5;
    font-size: 0.95rem;
  }

  .preview-stats {
    display: flex;
    gap: 15px;
    margin-top: 12px;
    justify-content: center;
  }

  .preview-interests {
    display: flex;
    flex-wrap: wrap;
    gap: 6px;
    margin: 15px 0;
  }

  .compatibility-preview {
    text-align: center;
    padding: 15px;
    background: #1a1a2e;
    border-radius: 10px;
    border: 1px solid rgba(99, 102, 241, 0.2);
  }

  .score-circle {
    width: 80px;
    height: 80px;
    border-radius: 50%;
    background: conic-gradient(#6366f1 0% 85%, #2d2d42 85% 100%);
    display: flex;
    align-items: center;
    justify-content: center;
    margin: 0 auto 12px;
    position: relative;
  }

  .score-circle::before {
    content: "";
    position: absolute;
    width: 64px;
    height: 64px;
    background: #2d2d42;
    border-radius: 50%;
  }

  .score-circle span {
    position: relative;
    z-index: 1;
    font-weight: bold;
    color: white;
    font-size: 1rem;
  }

  .setup-complete {
    text-align: center;
    padding: 30px 15px;
    background: linear-gradient(135deg, #1a1a2e, #0a0a0f);
    border-radius: 12px;
    border: 2px solid #06d6a0;
  }

  .completion-animation i {
    font-size: 48px;
    color: #06d6a0;
    margin-bottom: 15px;
    animation: bounce 1s ease infinite;
  }

  /* Step Actions - Mobile Optimized */
  .step-actions {
    display: flex;
    flex-direction: column;
    gap: 12px;
    margin-top: 30px;
    padding-top: 20px;
    border-top: 1px solid rgba(99, 102, 241, 0.2);
  }

  /* Button Styles - Mobile Optimized */
  .btn-primary,
  .btn-secondary {
    padding: 14px 20px;
    border-radius: 10px;
    font-weight: 600;
    font-size: 1rem;
    cursor: pointer;
    transition: all 0.3s ease;
    border: none;
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 8px;
    min-height: 50px; /* Minimum touch target size */
    text-align: center;
  }

  .btn-primary {
    background: linear-gradient(135deg, #6366f1, #3b82f6);
    color: white;
  }

  .btn-primary:hover {
    transform: translateY(-2px);
    box-shadow: 0 4px 12px rgba(99, 102, 241, 0.3);
  }

  .btn-secondary {
    background: #2d2d42;
    color: #e0e0e0;
    border: 2px solid #555;
  }

  .btn-secondary:hover {
    border-color: #6366f1;
    color: white;
  }

  /* Guided Tour */
  .tour-modal {
    max-width: 90%;
    background: #1a1a2e;
    border: 1px solid rgba(99, 102, 241, 0.2);
    border-radius: 15px;
  }

  .tour-step {
    display: none;
    text-align: center;
    padding: 25px 20px;
  }

  .tour-step.active {
    display: block;
    animation: fadeIn 0.5s ease;
  }

  .tour-actions {
    display: flex;
    gap: 10px;
    justify-content: center;
    margin-top: 20px;
  }

  /* Animations */
  @keyframes fadeInUp {
    from {
      opacity: 0;
      transform: translateY(30px);
    }
    to {
      opacity: 1;
      transform: translateY(0);
    }
  }

  @keyframes fadeIn {
    from {
      opacity: 0;
    }
    to {
      opacity: 1;
    }
  }

  @keyframes bounce {
    0%,
    20%,
    50%,
    80%,
    100% {
      transform: translateY(0);
    }
    40% {
      transform: translateY(-10px);
    }
    60% {
      transform: translateY(-5px);
    }
  }

  /* Tablet and Desktop Styles */
  @media (min-width: 768px) {
    .setup-container {
      padding: 20px;
    }

    .progress-steps {
      flex-wrap: nowrap;
    }

    .step {
      font-size: 0.9rem;
    }

    .setup-content {
      padding: 30px;
    }

    .setup-title {
      font-size: 2.2rem;
    }

    .form-grid {
      grid-template-columns: 1fr 1fr;
      display: grid;
    }

    .avatar-options {
      grid-template-columns: 1fr 1fr;
      display: grid;
    }

    .avatar-preview {
      width: 180px;
      height: 180px;
    }

    .avatar-initials-fallback {
      font-size: 3.5em;
    }

    .suggestion-grid {
      grid-template-columns: repeat(3, 1fr);
    }

    .preview-section {
      grid-template-columns: 1fr 1fr;
      display: grid;
    }

    .preview-header {
      flex-direction: row;
      text-align: left;
    }

    .preview-avatar {
      width: 100px;
      height: 100px;
      margin: 0;
    }

    .interests-grid {
      grid-template-columns: repeat(auto-fill, minmax(160px, 1fr));
    }

    .step-actions {
      flex-direction: row;
      justify-content: space-between;
    }

    .tour-modal {
      max-width: 500px;
    }
  }

  @media (min-width: 1024px) {
    .setup-container {
      padding: 30px;
    }

    .setup-title {
      font-size: 2.5rem;
    }

    .avatar-preview {
      width: 200px;
      height: 200px;
    }

    .avatar-controls {
      flex-direction: row;
      justify-content: space-around;
    }

    .interests-grid {
      grid-template-columns: repeat(auto-fill, minmax(180px, 1fr));
    }
  }

  .avatar-preview canvas {
    position: relative;
    z-index: 2;
    width: 100%;
    height: 100%;
    border-radius: 50%;
    display: block;
  }
</style>

<script>
  // Mobile-optimized JavaScript
  document.addEventListener("DOMContentLoaded", function () {
    // Initialize the setup
    generateAvatar();
    updateProgressBar();
    loadTrendingInterests();
    startGuidedTour();
    setupMobileOptimizations();

    // Add form submission handler
    setupFormSubmission();
  });

  // Setup mobile-specific optimizations
  function setupMobileOptimizations() {
    // Prevent zoom on input focus for iOS
    document.querySelectorAll("input, select, textarea").forEach((el) => {
      el.addEventListener("focus", function () {
        this.style.fontSize = "16px";
      });
    });

    // Handle touch events for better mobile interaction
    document.querySelectorAll(".interest-tag").forEach((tag) => {
      tag.addEventListener("touchstart", function () {
        this.style.transform = "scale(0.95)";
      });

      tag.addEventListener("touchend", function () {
        this.style.transform = "";
      });
    });

    // Adjust layout for mobile orientation changes
    window.addEventListener("orientationchange", function () {
      setTimeout(() => {
        updateProgressBar();
      }, 300);
    });
  }

  // Setup form submission
  function setupFormSubmission() {
    const form = document.getElementById("profileForm");
    const submitBtn = form.querySelector(".btn-complete");

    submitBtn.addEventListener("click", function (e) {
      e.preventDefault();
      handleFormSubmission();
    });
  }

  // Step Navigation
  let currentStep = 1;
  const totalSteps = 4;

  function nextStep() {
    if (currentStep < totalSteps) {
      document.getElementById(`step${currentStep}`).classList.remove("active");
      currentStep++;
      document.getElementById(`step${currentStep}`).classList.add("active");
      updateProgressBar();
      updatePreview();
    }
  }

  function prevStep() {
    if (currentStep > 1) {
      document.getElementById(`step${currentStep}`).classList.remove("active");
      currentStep--;
      document.getElementById(`step${currentStep}`).classList.add("active");
      updateProgressBar();
    }
  }

  function updateProgressBar() {
    const progress = (currentStep / totalSteps) * 100;
    document.getElementById("progressFill").style.width = `${progress}%`;

    // Update step indicators
    document.querySelectorAll(".step").forEach((step, index) => {
      if (index + 1 <= currentStep) {
        step.classList.add("active");
      } else {
        step.classList.remove("active");
      }
    });
  }

  // Avatar Generation
  function generateAvatar() {
    const style = document.getElementById("avatarStyle").value;
    const bgColor = document.getElementById("avatarBgColor").value;
    const mood = document.getElementById("avatarMood").value;

    // Show the canvas and hide initials fallback
    document.getElementById("avatarCanvas").style.display = "block";
    document.getElementById("avatarInitialsFallback").style.display = "none";

    const canvas = document.getElementById("avatarCanvas");
    const ctx = canvas.getContext("2d");

    // Clear canvas
    ctx.clearRect(0, 0, canvas.width, canvas.height);

    // Draw background
    ctx.fillStyle = bgColor;
    ctx.beginPath();
    ctx.arc(
      canvas.width / 2,
      canvas.height / 2,
      canvas.width / 2,
      0,
      Math.PI * 2
    );
    ctx.fill();

    // Generate avatar based on style and mood
    generateAvatarArt(ctx, canvas, style, mood);

    // Update preview
    updatePreview();
  }

  function generateAvatarArt(ctx, canvas, style, mood) {
    const centerX = canvas.width / 2;
    const centerY = canvas.height / 2;
    const radius = canvas.width / 2;

    ctx.fillStyle = "#ffffff";
    ctx.strokeStyle = "#ffffff";
    ctx.lineWidth = 2;

    switch (style) {
      case "adventurer":
        drawAdventurerAvatar(ctx, centerX, centerY, radius, mood);
        break;
      case "pixel":
        drawPixelAvatar(ctx, centerX, centerY, radius, mood);
        break;
      case "bottts":
        drawRobotAvatar(ctx, centerX, centerY, radius, mood);
        break;
      case "identicon":
        drawAbstractAvatar(ctx, centerX, centerY, radius, mood);
        break;
      case "avataaars":
        drawCartoonAvatar(ctx, centerX, centerY, radius, mood);
        break;
      default:
        drawDefaultAvatar(ctx, centerX, centerY, radius, mood);
    }
  }

  function drawAdventurerAvatar(ctx, centerX, centerY, radius, mood) {
    // Face
    ctx.fillStyle = "#ffdbac";
    ctx.beginPath();
    ctx.arc(centerX, centerY, radius * 0.8, 0, Math.PI * 2);
    ctx.fill();

    // Eyes
    ctx.fillStyle = "#2c3e50";
    const eyeY = centerY - radius * 0.1;
    const eyeSpacing = radius * 0.3;

    // Adjust eyes based on mood
    let eyeSize = radius * 0.1;
    if (mood === "happy") {
      // Smiling eyes
      ctx.beginPath();
      ctx.arc(centerX - eyeSpacing, eyeY, eyeSize, 0, Math.PI, true);
      ctx.stroke();
      ctx.beginPath();
      ctx.arc(centerX + eyeSpacing, eyeY, eyeSize, 0, Math.PI, true);
      ctx.stroke();
    } else {
      // Normal eyes
      ctx.beginPath();
      ctx.arc(centerX - eyeSpacing, eyeY, eyeSize, 0, Math.PI * 2);
      ctx.fill();
      ctx.beginPath();
      ctx.arc(centerX + eyeSpacing, eyeY, eyeSize, 0, Math.PI * 2);
      ctx.fill();
    }

    // Mouth based on mood
    ctx.strokeStyle = "#2c3e50";
    ctx.lineWidth = 2;
    const mouthY = centerY + radius * 0.2;

    switch (mood) {
      case "happy":
        // Smile
        ctx.beginPath();
        ctx.arc(centerX, mouthY, radius * 0.3, 0, Math.PI, false);
        ctx.stroke();
        break;
      case "serious":
        // Straight line
        ctx.beginPath();
        ctx.moveTo(centerX - radius * 0.2, mouthY);
        ctx.lineTo(centerX + radius * 0.2, mouthY);
        ctx.stroke();
        break;
      case "fun":
        // Winky face
        ctx.beginPath();
        ctx.arc(centerX - eyeSpacing, eyeY, eyeSize, 0, Math.PI * 2);
        ctx.fill();
        // Winking eye
        ctx.beginPath();
        ctx.moveTo(centerX + eyeSpacing - eyeSize, eyeY);
        ctx.lineTo(centerX + eyeSpacing + eyeSize, eyeY);
        ctx.stroke();
        // Smile
        ctx.beginPath();
        ctx.arc(centerX, mouthY, radius * 0.3, 0, Math.PI, false);
        ctx.stroke();
        break;
      default: // neutral
        // Small neutral mouth
        ctx.beginPath();
        ctx.arc(centerX, mouthY, radius * 0.15, 0, Math.PI, false);
        ctx.stroke();
    }
  }

  function drawPixelAvatar(ctx, centerX, centerY, radius, mood) {
    const pixelSize = radius * 0.2;

    // Face
    ctx.fillStyle = "#ffdbac";
    for (let i = -2; i <= 2; i++) {
      for (let j = -2; j <= 2; j++) {
        if (Math.abs(i) <= 2 && Math.abs(j) <= 2) {
          ctx.fillRect(
            centerX + i * pixelSize - pixelSize / 2,
            centerY + j * pixelSize - pixelSize / 2,
            pixelSize,
            pixelSize
          );
        }
      }
    }

    // Eyes
    ctx.fillStyle = "#2c3e50";
    ctx.fillRect(
      centerX - pixelSize * 1.5,
      centerY - pixelSize,
      pixelSize,
      pixelSize
    );
    ctx.fillRect(
      centerX + pixelSize * 0.5,
      centerY - pixelSize,
      pixelSize,
      pixelSize
    );

    // Mouth
    ctx.fillStyle = "#2c3e50";
    if (mood === "happy") {
      ctx.fillRect(
        centerX - pixelSize,
        centerY + pixelSize,
        pixelSize,
        pixelSize
      );
      ctx.fillRect(centerX, centerY + pixelSize * 1.5, pixelSize, pixelSize);
      ctx.fillRect(
        centerX + pixelSize,
        centerY + pixelSize,
        pixelSize,
        pixelSize
      );
    } else {
      ctx.fillRect(
        centerX - pixelSize,
        centerY + pixelSize,
        pixelSize * 3,
        pixelSize
      );
    }
  }

  function drawRobotAvatar(ctx, centerX, centerY, radius, mood) {
    // Head
    ctx.fillStyle = "#95a5a6";
    ctx.fillRect(
      centerX - radius * 0.6,
      centerY - radius * 0.6,
      radius * 1.2,
      radius * 1.2
    );

    // Eyes
    ctx.fillStyle = "#e74c3c";
    const eyeSize = radius * 0.15;
    ctx.fillRect(
      centerX - radius * 0.3,
      centerY - radius * 0.1,
      eyeSize,
      eyeSize
    );
    ctx.fillRect(
      centerX + radius * 0.15,
      centerY - radius * 0.1,
      eyeSize,
      eyeSize
    );

    // Mouth - antenna for fun mood
    if (mood === "fun") {
      ctx.fillStyle = "#e74c3c";
      ctx.fillRect(
        centerX - radius * 0.05,
        centerY,
        radius * 0.1,
        radius * 0.3
      );
      // Antenna ball
      ctx.beginPath();
      ctx.arc(centerX, centerY - radius * 0.8, radius * 0.1, 0, Math.PI * 2);
      ctx.fill();
    } else {
      ctx.fillStyle = "#34495e";
      ctx.fillRect(
        centerX - radius * 0.2,
        centerY + radius * 0.2,
        radius * 0.4,
        radius * 0.1
      );
    }
  }

  function drawAbstractAvatar(ctx, centerX, centerY, radius, mood) {
    // Abstract geometric pattern
    ctx.strokeStyle = "#ffffff";
    ctx.lineWidth = 3;

    const shapes = Math.random() > 0.5 ? 4 : 6;
    const angleStep = (Math.PI * 2) / shapes;

    for (let i = 0; i < shapes; i++) {
      const angle = i * angleStep;
      const x1 = centerX + Math.cos(angle) * radius * 0.3;
      const y1 = centerY + Math.sin(angle) * radius * 0.3;
      const x2 = centerX + Math.cos(angle) * radius * 0.7;
      const y2 = centerY + Math.sin(angle) * radius * 0.7;

      ctx.beginPath();
      ctx.moveTo(x1, y1);
      ctx.lineTo(x2, y2);
      ctx.stroke();

      // Add circles at endpoints for some moods
      if (mood === "happy" || mood === "fun") {
        ctx.beginPath();
        ctx.arc(x2, y2, radius * 0.1, 0, Math.PI * 2);
        ctx.fill();
      }
    }
  }

  function drawCartoonAvatar(ctx, centerX, centerY, radius, mood) {
    // Simple cartoon face
    ctx.fillStyle = "#ffdbac";
    ctx.beginPath();
    ctx.arc(centerX, centerY, radius * 0.8, 0, Math.PI * 2);
    ctx.fill();

    // Big cartoon eyes
    ctx.fillStyle = "white";
    ctx.beginPath();
    ctx.arc(
      centerX - radius * 0.25,
      centerY - radius * 0.1,
      radius * 0.15,
      0,
      Math.PI * 2
    );
    ctx.fill();
    ctx.beginPath();
    ctx.arc(
      centerX + radius * 0.25,
      centerY - radius * 0.1,
      radius * 0.15,
      0,
      Math.PI * 2
    );
    ctx.fill();

    // Pupils
    ctx.fillStyle = "#2c3e50";
    ctx.beginPath();
    ctx.arc(
      centerX - radius * 0.25,
      centerY - radius * 0.1,
      radius * 0.07,
      0,
      Math.PI * 2
    );
    ctx.fill();
    ctx.beginPath();
    ctx.arc(
      centerX + radius * 0.25,
      centerY - radius * 0.1,
      radius * 0.07,
      0,
      Math.PI * 2
    );
    ctx.fill();

    // Mouth based on mood
    ctx.strokeStyle = "#e74c3c";
    ctx.lineWidth = 3;
    const mouthY = centerY + radius * 0.3;

    if (mood === "happy") {
      ctx.beginPath();
      ctx.arc(centerX, mouthY, radius * 0.2, 0.1, Math.PI - 0.1, false);
      ctx.stroke();
    } else if (mood === "serious") {
      ctx.beginPath();
      ctx.moveTo(centerX - radius * 0.15, mouthY);
      ctx.lineTo(centerX + radius * 0.15, mouthY);
      ctx.stroke();
    } else {
      ctx.beginPath();
      ctx.arc(centerX, mouthY, radius * 0.15, 0, Math.PI, false);
      ctx.stroke();
    }
  }

  function drawDefaultAvatar(ctx, centerX, centerY, radius, mood) {
    // Simple fallback avatar
    ctx.fillStyle = "#3498db";
    ctx.beginPath();
    ctx.arc(centerX, centerY, radius * 0.7, 0, Math.PI * 2);
    ctx.fill();

    ctx.fillStyle = "white";
    ctx.font = "bold 24px Arial";
    ctx.textAlign = "center";
    ctx.textBaseline = "middle";
    ctx.fillText("AI", centerX, centerY);
  }

  function useInitialsAvatar() {
    // Hide canvas and show initials fallback
    document.getElementById("avatarCanvas").style.display = "none";
    document.getElementById("avatarInitialsFallback").style.display = "flex";

    // Get display name for initials
    const displayName = document.getElementById("display_name").value || "User";
    const initials = displayName
      .split(" ")
      .map((n) => n[0])
      .join("")
      .toUpperCase()
      .substring(0, 2);

    document.getElementById("avatarInitials").textContent = initials;
    updatePreview();
  }

  // Interests Management
  function updateInterestsCount() {
    const selectedInterests = document.querySelectorAll(
      'input[name="interests"]:checked'
    ).length;
    document.getElementById("selectedCount").textContent = selectedInterests;

    const continueButton = document.getElementById("continueToPreview");
    continueButton.disabled = selectedInterests < 3;

    updatePreview();
  }

  function loadTrendingInterests() {
    // In a real app, this would fetch trending interests from an API
    const trendingInterests = [
      "AI",
      "Web3",
      "Crypto",
      "VR",
      "Gaming",
      "Startups",
      "Programming",
      "Design",
    ];

    const trendingTagsContainer = document.getElementById("trendingTags");
    trendingTagsContainer.innerHTML = "";

    trendingInterests.forEach((interest) => {
      const tag = document.createElement("span");
      tag.className = "interest-tag";
      tag.textContent = interest;
      tag.style.cursor = "pointer";
      tag.onclick = function () {
        // Find and check the corresponding checkbox
        const checkbox = document.querySelector(`input[value="${interest}"]`);
        if (checkbox) {
          checkbox.checked = true;
          updateInterestsCount();
        }
      };
      trendingTagsContainer.appendChild(tag);
    });
  }

  // Preview Updates
  function updatePreview() {
    // Update name and username
    const displayName =
      document.getElementById("display_name").value || "Display Name";
    const username = document.getElementById("username").value || "username";
    document.getElementById("previewName").textContent = displayName;
    document.getElementById("previewUsername").textContent = `@${username}`;

    // Update bio
    const bio =
      document.getElementById("bio").value || "Bio will appear here...";
    document.getElementById("previewBio").textContent = bio;

    // Update age
    const age = document.getElementById("age").value;
    document.getElementById("previewAge").textContent = age || "--";

    // Update interests count
    const selectedInterests = document.querySelectorAll(
      'input[name="interests"]:checked'
    ).length;
    document.getElementById("previewInterestsCount").textContent =
      selectedInterests;

    // Update avatar preview
    const avatarCanvas = document.getElementById("avatarCanvas");
    const avatarInitials = document.getElementById("avatarInitialsFallback");

    if (avatarCanvas.style.display !== "none") {
      // Using AI avatar - convert canvas to image for preview
      const canvas = document.getElementById("avatarCanvas");
      const dataURL = canvas.toDataURL();
      const previewAvatar = document.getElementById("previewAvatar");

      previewAvatar.src = dataURL;
      previewAvatar.style.display = "block";
      document.getElementById("previewAvatarInitials").style.display = "none";
    } else {
      // Using initials avatar
      document.getElementById("previewAvatar").style.display = "none";
      document.getElementById("previewAvatarInitials").style.display = "flex";
      document.getElementById("previewAvatarInitialsText").textContent =
        document.getElementById("avatarInitials").textContent;
    }

    // Update selected interests in preview
    updatePreviewInterests();

    // Update character count
    const bioText = document.getElementById("bio").value;
    document.getElementById("charCount").textContent = bioText.length;

    // Update compatibility score based on profile completeness
    updateCompatibilityScore();
  }

  function updatePreviewInterests() {
    const selectedInterests = Array.from(
      document.querySelectorAll('input[name="interests"]:checked')
    ).map((checkbox) => checkbox.value);

    const previewInterestsContainer =
      document.getElementById("previewInterests");
    previewInterestsContainer.innerHTML = "";

    selectedInterests.slice(0, 8).forEach((interest) => {
      const tag = document.createElement("span");
      tag.className = "interest-tag";
      tag.textContent = interest;
      previewInterestsContainer.appendChild(tag);
    });

    if (selectedInterests.length > 8) {
      const moreTag = document.createElement("span");
      moreTag.className = "interest-tag";
      moreTag.textContent = `+${selectedInterests.length - 8} more`;
      previewInterestsContainer.appendChild(moreTag);
    }
  }

  function updateCompatibilityScore() {
    // Calculate a simple compatibility score based on profile completeness
    let score = 50; // Base score

    // Add points for filled fields
    if (document.getElementById("display_name").value.length > 0) score += 10;
    if (document.getElementById("username").value.length >= 3) score += 10;
    if (document.getElementById("bio").value.length > 20) score += 10;
    if (document.getElementById("age").value) score += 5;

    // Add points for interests (max 15 points)
    const interestCount = document.querySelectorAll(
      'input[name="interests"]:checked'
    ).length;
    score += Math.min(interestCount * 5, 15);

    // Ensure score doesn't exceed 100
    score = Math.min(score, 100);

    document.getElementById("compatibilityScore").textContent = `${score}%`;

    // Update the score circle visual
    const scoreCircle = document.querySelector(".score-circle");
    if (scoreCircle) {
      scoreCircle.style.background = `conic-gradient(#6366f1 0% ${score}%, #2d2d42 ${score}% 100%)`;
    }
  }

  // Username Availability Check
  function checkUsernameAvailability() {
    const username = document.getElementById("username").value;
    const feedback = document.getElementById("usernameFeedback");

    if (username.length < 3) {
      feedback.textContent = "Username must be at least 3 characters";
      feedback.style.color = "#f87171";
      return;
    }

    if (!/^[a-zA-Z0-9_]+$/.test(username)) {
      feedback.textContent =
        "Username can only contain letters, numbers, and underscores";
      feedback.style.color = "#f87171";
      return;
    }

    // Simulate API check
    setTimeout(() => {
      feedback.textContent = "‚úì Username is available";
      feedback.style.color = "#06d6a0";
    }, 500);
  }

  // Guided Tour
  let currentTourStep = 1;

  function startGuidedTour() {
    document.getElementById("guidedTour").style.display = "flex";
  }

  function nextTourStep() {
    document
      .getElementById(`tourStep${currentTourStep}`)
      .classList.remove("active");
    currentTourStep++;
    document
      .getElementById(`tourStep${currentTourStep}`)
      .classList.add("active");
  }

  function prevTourStep() {
    document
      .getElementById(`tourStep${currentTourStep}`)
      .classList.remove("active");
    currentTourStep--;
    document
      .getElementById(`tourStep${currentTourStep}`)
      .classList.add("active");
  }

  function skipTour() {
    document.getElementById("guidedTour").style.display = "none";
  }

  function completeTour() {
    document.getElementById("guidedTour").style.display = "none";
  }

  // File upload handling
  document
    .getElementById("photoUpload")
    .addEventListener("change", function (e) {
      const file = e.target.files[0];
      if (file) {
        const reader = new FileReader();
        reader.onload = function (e) {
          // Show AI suggestions when a photo is uploaded
          document.getElementById("aiSuggestion").style.display = "block";
          generateAISuggestions(e.target.result);
        };
        reader.readAsDataURL(file);
      }
    });

  function generateAISuggestions(photoData) {
    // In a real implementation, this would call an AI service
    // For demo, we'll generate some mock suggestions
    const suggestionGrid = document.getElementById("suggestionGrid");
    suggestionGrid.innerHTML = "";

    const styles = ["Cartoon", "Anime", "Pixel Art", "Cyberpunk", "Watercolor"];

    styles.forEach((style) => {
      const suggestionItem = document.createElement("div");
      suggestionItem.className = "suggestion-item";
      suggestionItem.innerHTML = `
        <div style="width: 80px; height: 80px; background: #6366f1; border-radius: 8px; margin: 0 auto 8px; display: flex; align-items: center; justify-content: center; color: white; font-size: 12px; text-align: center;">
          ${style}
        </div>
        <span style="font-size: 12px;">${style}</span>
      `;
      suggestionItem.onclick = function () {
        alert(`AI ${style} avatar would be generated here`);
      };
      suggestionGrid.appendChild(suggestionItem);
    });
  }

  // Interest search functionality
  document
    .getElementById("interestSearch")
    .addEventListener("input", function (e) {
      const searchTerm = e.target.value.toLowerCase();
      const interestTags = document.querySelectorAll(".interest-tag");

      interestTags.forEach((tag) => {
        const interestText = tag.textContent.toLowerCase();
        const checkbox = tag.previousElementSibling;

        if (interestText.includes(searchTerm)) {
          tag.parentElement.style.display = "block";
        } else {
          tag.parentElement.style.display = "none";
        }
      });
    });

  // Form submission handler
  function handleFormSubmission() {
    // Validate minimum interests
    const selectedInterests = document.querySelectorAll(
      'input[name="interests"]:checked'
    ).length;
    if (selectedInterests < 3) {
      alert(
        "Please select at least 3 interests before completing your profile."
      );
      // Go back to interests step
      document.getElementById(`step${currentStep}`).classList.remove("active");
      currentStep = 3;
      document.getElementById(`step${currentStep}`).classList.add("active");
      updateProgressBar();
      return;
    }

    // Show loading state
    const submitBtn = document.querySelector(".btn-complete");
    const originalText = submitBtn.innerHTML;
    submitBtn.innerHTML =
      '<i class="fas fa-spinner fa-spin"></i> Creating Profile...';
    submitBtn.disabled = true;

    // Collect form data
    const formData = {
      display_name: document.getElementById("display_name").value,
      username: document.getElementById("username").value,
      age: document.getElementById("age").value,
      gender: document.getElementById("gender").value,
      bio: document.getElementById("bio").value,
      interests: Array.from(
        document.querySelectorAll('input[name="interests"]:checked')
      ).map((cb) => cb.value),
      avatar_type:
        document.getElementById("avatarCanvas").style.display !== "none"
          ? "ai"
          : "initials",
      avatar_style: document.getElementById("avatarStyle").value,
      avatar_bg_color: document.getElementById("avatarBgColor").value,
      avatar_mood: document.getElementById("avatarMood").value,
      avatar_initials: document.getElementById("avatarInitials").textContent,
    };

    console.log("Form data to be submitted:", formData);

    // Simulate API call to save profile
    setTimeout(() => {
      showSuccessAnimation();

      // Redirect to dashboard after success animation
      setTimeout(() => {
        redirectToDashboard();
      }, 2000);
    }, 1500);
  }

  function showSuccessAnimation() {
    const completionSection = document.querySelector(".setup-complete");
    if (!completionSection) return;

    const completionIcon = completionSection.querySelector("i");

    // Change to checkmark and animate
    completionIcon.className = "fas fa-check-circle";
    completionIcon.style.color = "#06d6a0";

    // Add pulsing animation
    completionSection.style.animation = "pulse 1s ease-in-out";

    // Update text
    const title = completionSection.querySelector("h3");
    const subtitle = completionSection.querySelector("p");

    if (title) title.textContent = "Profile Created Successfully!";
    if (subtitle) subtitle.textContent = "Redirecting to your dashboard...";
  }

  function redirectToDashboard() {
    // Option 1: Redirect to actual dashboard (uncomment below)
    // window.location.href = '/dashboard';

    // Option 2: Show success page (for demo)
    showSuccessPage();
  }

  function showSuccessPage() {
    const setupContainer = document.querySelector(".setup-container");
    if (!setupContainer) return;

    setupContainer.innerHTML = `
      <div class="success-redirect">
        <div class="success-animation">
          <i class="fas fa-check-circle"></i>
        </div>
        <h2>Welcome to ShadowTalk! üéâ</h2>
        <p>Your profile has been created successfully and you're all set to start chatting.</p>
        <div class="redirect-message">
          <p><strong>Next Steps:</strong></p>
          <ul>
            <li>Explore chat rooms</li>
            <li>Find users with similar interests</li>
            <li>Start conversations</li>
            <li>Customize your settings</li>
          </ul>
        </div>
        <div class="redirect-actions">
          <button class="btn-primary" onclick="goToDashboard()">
            Go to Dashboard <i class="fas fa-arrow-right"></i>
          </button>
          <button class="btn-secondary" onclick="editProfile()">
            Edit Profile <i class="fas fa-edit"></i>
          </button>
        </div>
      </div>
    `;

    // Add styles for success page
    addSuccessPageStyles();
  }

  function addSuccessPageStyles() {
    if (document.querySelector("#success-page-styles")) return;

    const style = document.createElement("style");
    style.id = "success-page-styles";
    style.textContent = `
      .success-redirect {
        text-align: center;
        padding: 40px 20px;
        background: #1a1a2e;
        border-radius: 15px;
        border: 1px solid rgba(99, 102, 241, 0.2);
        margin: 20px 0;
        max-width: 600px;
        margin-left: auto;
        margin-right: auto;
      }
      .success-animation i {
        font-size: 80px;
        color: #06d6a0;
        margin-bottom: 20px;
        animation: bounce 1s ease infinite;
      }
      .success-redirect h2 {
        color: #6366f1;
        margin-bottom: 15px;
        font-size: 2rem;
      }
      .success-redirect p {
        color: #ccc;
        margin-bottom: 20px;
        font-size: 1.1rem;
        line-height: 1.5;
      }
      .redirect-message {
        background: #2d2d42;
        padding: 20px;
        border-radius: 10px;
        margin: 20px 0;
        text-align: left;
      }
      .redirect-message p {
        color: #e0e0e0;
        font-weight: 600;
        margin-bottom: 10px;
      }
      .redirect-message ul {
        color: #ccc;
        margin: 10px 0;
        padding-left: 20px;
      }
      .redirect-message li {
        margin: 8px 0;
        line-height: 1.4;
      }
      .redirect-actions {
        margin-top: 30px;
        display: flex;
        gap: 15px;
        justify-content: center;
        flex-wrap: wrap;
      }
      .redirect-actions .btn-primary,
      .redirect-actions .btn-secondary {
        min-width: 160px;
      }
      @keyframes pulse {
        0% { transform: scale(1); }
        50% { transform: scale(1.05); }
        100% { transform: scale(1); }
      }
      @keyframes bounce {
        0%, 20%, 50%, 80%, 100% {
          transform: translateY(0);
        }
        40% {
          transform: translateY(-10px);
        }
        60% {
          transform: translateY(-5px);
        }
      }
    `;
    document.head.appendChild(style);
  }

  function goToDashboard() {
    // This would redirect to actual dashboard
    alert(
      'Redirecting to dashboard... In a real app, use: window.location.href = "/dashboard"'
    );
    // window.location.href = '/dashboard';
  }

  function editProfile() {
    // Reload the page to show the form again
    window.location.reload();
  }
</script>
{% endblock %}
