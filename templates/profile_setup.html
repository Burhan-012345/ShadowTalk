{% extends "base.html" %} {% block content %}
<!-- Guided Tour Modal - Show First -->
<div id="guidedTour" class="modal" style="display: flex;">
  <div class="modal-content tour-modal">
    <div class="tour-content">
      <div class="tour-step active" id="tourStep1">
        <h3>Welcome to Profile Setup! 🎯</h3>
        <p>
          We'll guide you through creating an amazing profile that helps you
          find great matches.
        </p>
        <div class="tour-actions">
          <button class="btn-primary" onclick="nextTourStep()">
            Let's Start!
          </button>
          <button class="btn-secondary" onclick="skipTour()">Skip Tour</button>
        </div>
      </div>
      <div class="tour-step" id="tourStep2">
        <h3>Your Display Identity 👤</h3>
        <p>
          Choose a display name and username that represent you. This is how
          others will see you.
        </p>
        <div class="tour-actions">
          <button class="btn-secondary" onclick="prevTourStep()">Back</button>
          <button class="btn-primary" onclick="nextTourStep()">Next</button>
        </div>
      </div>
      <div class="tour-step" id="tourStep3">
        <h3>Create Your Avatar 🎨</h3>
        <p>
          Use our AI avatar generator or upload a photo. Your avatar helps
          others recognize you.
        </p>
        <div class="tour-actions">
          <button class="btn-secondary" onclick="prevTourStep()">Back</button>
          <button class="btn-primary" onclick="nextTourStep()">Next</button>
        </div>
      </div>
      <div class="tour-step" id="tourStep4">
        <h3>Share Your Interests 🌟</h3>
        <p>
          Select interests to get matched with like-minded people. Choose at
          least 3 for best results.
        </p>
        <div class="tour-actions">
          <button class="btn-secondary" onclick="prevTourStep()">Back</button>
          <button class="btn-primary" onclick="completeTour()">Got It!</button>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Main Profile Setup Content - Hidden Initially -->
<div class="setup-container" id="mainSetupContent" style="display: none;">
  <!-- Progress Bar -->
  <div class="setup-progress">
    <div class="progress-bar">
      <div class="progress-fill" id="progressFill"></div>
    </div>
    <div class="progress-steps">
      <span class="step active" data-step="1">Basic Info</span>
      <span class="step" data-step="2">Avatar</span>
      <span class="step" data-step="3">Interests</span>
      <span class="step" data-step="4">Preview</span>
    </div>
  </div>

  <div class="setup-content">
    <!-- Step 1: Basic Information -->
    <div class="setup-step active" id="step1">
      <div class="setup-header">
        <h2 class="setup-title">Welcome to ShadowTalk! 👋</h2>
        <p class="setup-subtitle">
          Let's create your amazing profile. We'll help you every step of the
          way.
        </p>
      </div>

      <form method="POST" class="setup-form" id="profileForm">
        <div class="form-grid">
          <div class="form-group">
            <label for="display_name" class="form-label">
              Display Name
              <span
                class="tooltip-icon"
                data-tooltip="This is how other users will see you"
                >ℹ️</span
              >
            </label>
            <input
              type="text"
              id="display_name"
              name="display_name"
              required
              class="form-input"
              placeholder="Enter your display name"
              oninput="updatePreview()"
            />
            <div class="input-feedback" id="nameFeedback"></div>
          </div>

          <div class="form-group">
            <label for="username" class="form-label">
              Username
              <span
                class="tooltip-icon"
                data-tooltip="Your unique identifier on the platform"
                >ℹ️</span
              >
            </label>
            <input
              type="text"
              id="username"
              name="username"
              required
              class="form-input"
              placeholder="Choose a username"
              oninput="checkUsernameAvailability()"
            />
            <div class="input-feedback" id="usernameFeedback"></div>
          </div>
        </div>

        <div class="form-grid">
          <div class="form-group">
            <label for="age" class="form-label">Age</label>
            <input
              type="number"
              id="age"
              name="age"
              min="13"
              max="100"
              class="form-input"
              oninput="updatePreview()"
            />
          </div>

          <div class="form-group">
            <label for="gender" class="form-label">Gender</label>
            <select
              id="gender"
              name="gender"
              class="form-input"
              onchange="updatePreview()"
            >
              <option value="">Prefer not to say</option>
              <option value="male">Male</option>
              <option value="female">Female</option>
              <option value="other">Other</option>
            </select>
          </div>
        </div>

        <div class="form-group">
          <label for="bio" class="form-label">
            Bio
            <span
              class="tooltip-icon"
              data-tooltip="Share a bit about yourself to help others get to know you"
              >ℹ️</span
            >
          </label>
          <textarea
            id="bio"
            name="bio"
            class="form-input"
            rows="3"
            placeholder="Tell us about yourself, your interests, or what you're looking for..."
            oninput="updatePreview()"
          ></textarea>
          <div class="char-counter">
            <span id="charCount">0</span>/200 characters
          </div>
        </div>

        <div class="step-actions">
          <button type="button" class="btn-secondary" onclick="nextStep()">
            Continue to Avatar <i class="fas fa-arrow-right"></i>
          </button>
        </div>
      </form>
    </div>

    <!-- Step 2: Avatar Setup -->
    <div class="setup-step" id="step2">
      <div class="setup-header">
        <h2 class="setup-title">Create Your Avatar 🎨</h2>
        <p class="setup-subtitle">
          Choose or create an avatar that represents you
        </p>
      </div>

      <div class="avatar-section">
        <div class="avatar-options">
          <!-- AI Avatar Generator -->
          <div class="avatar-option active" id="aiAvatarOption">
            <div class="option-header">
              <h4>AI Avatar Generator</h4>
              <span class="badge">Recommended</span>
            </div>
            <div class="avatar-preview-container">
              <div class="avatar-preview" id="aiAvatarPreview">
                <canvas id="avatarCanvas" width="200" height="200"></canvas>
                <div
                  class="avatar-initials-fallback"
                  id="avatarInitialsFallback"
                  style="display: none"
                >
                  <span id="avatarInitials">U</span>
                </div>
              </div>
              <div class="avatar-controls">
                <div class="control-group">
                  <label>Style:</label>
                  <select id="avatarStyle" onchange="generateAvatar()">
                    <option value="adventurer">Adventurer</option>
                    <option value="pixel">Pixel Art</option>
                    <option value="bottts">Robot</option>
                    <option value="identicon">Abstract</option>
                    <option value="avataaars">Cartoon</option>
                  </select>
                </div>
                <div class="control-group">
                  <label>Background:</label>
                  <input
                    type="color"
                    id="avatarBgColor"
                    value="#8b5cf6"
                    onchange="generateAvatar()"
                  />
                </div>
                <div class="control-group">
                  <label>Mood:</label>
                  <select id="avatarMood" onchange="generateAvatar()">
                    <option value="happy">😊 Happy</option>
                    <option value="neutral">😐 Neutral</option>
                    <option value="serious">😠 Serious</option>
                    <option value="fun">😎 Cool</option>
                  </select>
                </div>
              </div>
            </div>
            <button class="btn-primary" onclick="generateAvatar()">
              <i class="fas fa-sync-alt"></i> Regenerate
            </button>
            <button
              type="button"
              class="btn-secondary"
              onclick="useInitialsAvatar()"
            >
              <i class="fas fa-user-circle"></i> Use Initials Instead
            </button>
          </div>

          <!-- Photo Upload Option -->
          <div class="avatar-option" id="photoUploadOption">
            <div class="option-header">
              <h4>Upload Photo</h4>
            </div>
            <div class="upload-area" id="uploadArea">
              <i class="fas fa-cloud-upload-alt"></i>
              <p>Drag & drop your photo here</p>
              <span>or</span>
              <input
                type="file"
                id="photoUpload"
                accept="image/*"
                style="display: none"
              />
              <button
                class="btn-secondary"
                onclick="document.getElementById('photoUpload').click()"
              >
                Choose File
              </button>
            </div>
            <div class="ai-suggestion" id="aiSuggestion" style="display: none">
              <h5>AI Avatar Suggestions</h5>
              <div class="suggestion-grid" id="suggestionGrid">
                <!-- AI suggestions will be generated here -->
              </div>
            </div>
          </div>
        </div>

        <div class="step-actions">
          <button type="button" class="btn-secondary" onclick="prevStep()">
            <i class="fas fa-arrow-left"></i> Back
          </button>
          <button type="button" class="btn-primary" onclick="nextStep()">
            Continue to Interests <i class="fas fa-arrow-right"></i>
          </button>
        </div>
      </div>
    </div>

    <!-- Step 3: Interests -->
    <div class="setup-step" id="step3">
      <div class="setup-header">
        <h2 class="setup-title">Choose Your Interests 🌟</h2>
        <p class="setup-subtitle">
          Select interests to get better matches (choose at least 3)
        </p>
        <div class="interests-counter">
          <span id="selectedCount">0</span>/3 selected
        </div>
      </div>

      <div class="interests-section">
        <!-- Smart Suggestions -->
        <div class="smart-suggestions">
          <h4>AI Suggestions Based on Your Profile</h4>
          <div class="suggested-interests" id="suggestedInterests">
            <!-- AI-suggested interests will appear here -->
          </div>
        </div>

        <!-- Trending Interests -->
        <div class="trending-interests">
          <h4>Trending Now 🔥</h4>
          <div class="trending-tags" id="trendingTags">
            <!-- Trending interests will be loaded here -->
          </div>
        </div>

        <!-- All Interests Grid -->
        <div class="interests-grid-container">
          <div class="search-box">
            <i class="fas fa-search"></i>
            <input
              type="text"
              id="interestSearch"
              placeholder="Search interests..."
            />
          </div>
          <div class="interests-grid" id="interestsGrid">
            {% set interests = ['Technology', 'Music', 'Sports', 'Gaming',
            'Movies', 'Books', 'Travel', 'Food', 'Art', 'Science', 'Fitness',
            'Fashion', 'Photography', 'Nature', 'Business', 'Programming', 'AI',
            'Blockchain', 'Startups', 'Psychology', 'Philosophy', 'History',
            'Politics', 'Environment', 'Space', 'Robotics', 'VR/AR',
            'Cryptocurrency', 'Digital Art', 'Podcasts', 'Yoga', 'Meditation',
            'Cooking', 'Baking', 'Gardening', 'Anime', 'Manga', 'Comics', 'Board
            Games', 'Chess', 'Cryptography', 'Cybersecurity', 'Data Science'] %}
            {% for interest in interests %}
            <label class="interest-checkbox">
              <input
                type="checkbox"
                name="interests"
                value="{{ interest }}"
                onchange="updateInterestsCount()"
              />
              <span class="interest-tag">{{ interest }}</span>
            </label>
            {% endfor %}
          </div>
        </div>
      </div>

      <div class="step-actions">
        <button type="button" class="btn-secondary" onclick="prevStep()">
          <i class="fas fa-arrow-left"></i> Back
        </button>
        <button
          type="button"
          class="btn-primary"
          id="continueToPreview"
          onclick="nextStep()"
          disabled
        >
          Continue to Preview <i class="fas fa-arrow-right"></i>
        </button>
      </div>
    </div>

    <!-- Step 4: Preview & Complete -->
    <div class="setup-step" id="step4">
      <div class="setup-header">
        <h2 class="setup-title">Almost Done! 🎉</h2>
        <p class="setup-subtitle">
          Review your profile before completing setup
        </p>
      </div>

      <div class="preview-section">
        <div class="profile-preview">
          <div class="preview-header">
            <div class="preview-avatar">
              <img
                id="previewAvatar"
                src=""
                alt="Profile Avatar"
                style="display: none"
              />
              <div class="avatar-initials-fallback" id="previewAvatarInitials">
                <span id="previewAvatarInitialsText">U</span>
              </div>
            </div>
            <div class="preview-info">
              <h3 id="previewName">Display Name</h3>
              <p id="previewUsername">@username</p>
              <p class="preview-bio" id="previewBio">Bio will appear here...</p>
              <div class="preview-stats">
                <div class="stat">
                  <span class="stat-number" id="previewInterestsCount">0</span>
                  <span class="stat-label">Interests</span>
                </div>
                <div class="stat">
                  <span class="stat-number" id="previewAge">--</span>
                  <span class="stat-label">Age</span>
                </div>
              </div>
            </div>
          </div>

          <div class="preview-interests" id="previewInterests">
            <!-- Selected interests will appear here -->
          </div>

          <div class="compatibility-preview">
            <h4>Estimated Match Compatibility</h4>
            <div class="compatibility-score">
              <div class="score-circle">
                <span id="compatibilityScore">85%</span>
              </div>
              <p>Based on your interests and profile completeness</p>
            </div>
          </div>
        </div>

        <div class="setup-complete">
          <div class="completion-animation">
            <i class="fas fa-check-circle"></i>
          </div>
          <h3>Ready to Start Chatting!</h3>
          <p>Your profile is complete and optimized for great matches</p>
        </div>
      </div>

      <div class="step-actions">
        <button type="button" class="btn-secondary" onclick="prevStep()">
          <i class="fas fa-arrow-left"></i> Back
        </button>
        <button
          type="submit"
          class="btn-primary btn-complete"
          form="profileForm"
        >
          Complete Profile & Start Chatting <i class="fas fa-rocket"></i>
        </button>
      </div>
    </div>
  </div>
</div>

<style>
  /* Enhanced Setup Styles - Mobile First Approach - Dark Skyline Blue Theme */
  .setup-container {
    max-width: 1000px;
    margin: 0 auto;
    padding: 15px;
    min-height: 100vh;
    background: #0a0f1c;
  }

  /* Progress Bar - Mobile Optimized */
  .setup-progress {
    margin-bottom: 30px;
  }

  .progress-bar {
    height: 6px;
    background: #1e2a44;
    border-radius: 3px;
    margin-bottom: 15px;
    overflow: hidden;
  }

  .progress-fill {
    height: 100%;
    background: linear-gradient(90deg, #38bdf8, #0ea5e9);
    border-radius: 3px;
    transition: width 0.5s ease;
    width: 25%;
  }

  .progress-steps {
    display: flex;
    justify-content: space-between;
    position: relative;
    flex-wrap: wrap;
    gap: 10px;
  }

  .progress-steps::before {
    content: "";
    position: absolute;
    top: 50%;
    left: 0;
    right: 0;
    height: 2px;
    background: #1e2a44;
    z-index: 1;
  }

  .step {
    position: relative;
    z-index: 2;
    background: #152238;
    padding: 8px 12px;
    border-radius: 20px;
    color: #88a0c7;
    font-weight: 500;
    transition: all 0.3s ease;
    border: 1px solid rgba(56, 189, 248, 0.2);
    font-size: 0.85rem;
    flex: 1;
    text-align: center;
    min-width: 0;
    overflow: hidden;
    text-overflow: ellipsis;
    white-space: nowrap;
  }

  .step.active {
    background: #38bdf8;
    color: #0a0f1c;
  }

  /* Setup Steps */
  .setup-content {
    background: #152238;
    border-radius: 15px;
    padding: 20px;
    border: 1px solid rgba(56, 189, 248, 0.2);
  }

  .setup-step {
    display: none;
  }

  .setup-step.active {
    display: block;
    animation: fadeInUp 0.5s ease;
  }

  .setup-header {
    text-align: center;
    margin-bottom: 30px;
  }

  .setup-title {
    font-size: 1.8rem;
    margin-bottom: 10px;
    background: linear-gradient(135deg, #38bdf8, #0ea5e9);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    line-height: 1.2;
  }

  .setup-subtitle {
    color: #88a0c7;
    font-size: 1rem;
    line-height: 1.4;
  }

  /* Form Styles - Mobile Optimized */
  .form-grid {
    display: flex;
    flex-direction: column;
    gap: 15px;
    margin-bottom: 15px;
  }

  .form-group {
    margin-bottom: 20px;
  }

  .form-label {
    display: flex;
    align-items: center;
    gap: 8px;
    margin-bottom: 8px;
    font-weight: 600;
    color: #cbd5e1;
    font-size: 0.95rem;
  }

  .tooltip-icon {
    cursor: help;
    font-size: 0.8em;
    position: relative;
  }

  .tooltip-icon:hover::after {
    content: attr(data-tooltip);
    position: absolute;
    bottom: 100%;
    left: 50%;
    transform: translateX(-50%);
    background: #1e2a44;
    color: #e2e8f0;
    padding: 8px 12px;
    border-radius: 6px;
    font-size: 12px;
    white-space: nowrap;
    z-index: 1000;
    border: 1px solid rgba(56, 189, 248, 0.2);
  }

  .form-input {
    width: 100%;
    padding: 14px 16px;
    background: #1e2a44;
    border: 2px solid #334155;
    border-radius: 10px;
    color: #e2e8f0;
    font-size: 16px;
    transition: all 0.3s ease;
    box-sizing: border-box;
    -webkit-appearance: none;
  }

  .form-input:focus {
    border-color: #38bdf8;
    outline: none;
    box-shadow: 0 0 0 3px rgba(56, 189, 248, 0.1);
  }

  .input-feedback {
    margin-top: 5px;
    font-size: 14px;
    min-height: 20px;
  }

  .char-counter {
    text-align: right;
    font-size: 12px;
    color: #88a0c7;
    margin-top: 5px;
  }

  /* Avatar Section - Mobile Optimized */
  .avatar-options {
    display: flex;
    flex-direction: column;
    gap: 20px;
    margin-bottom: 25px;
  }

  .avatar-option {
    background: #1e2a44;
    border: 2px solid #334155;
    border-radius: 12px;
    padding: 20px;
    transition: all 0.3s ease;
  }

  .avatar-option.active {
    border-color: #38bdf8;
    background: rgba(56, 189, 248, 0.05);
  }

  .option-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 15px;
  }

  .badge {
    background: #0ea5e9;
    color: #0a0f1c;
    padding: 4px 8px;
    border-radius: 12px;
    font-size: 12px;
    font-weight: bold;
  }

  .avatar-preview-container {
    text-align: center;
    margin-bottom: 15px;
  }

  .avatar-preview {
    position: relative;
    width: 150px;
    height: 150px;
    margin: 0 auto 15px;
    border-radius: 50%;
    overflow: hidden;
    border: 4px solid #38bdf8;
    background: #0a0f1c;
  }

  .avatar-preview canvas {
    position: relative;
    z-index: 2;
    max-width: 100%;
    height: auto;
  }

  /* Avatar Initials Styles */
  .avatar-initials-fallback {
    width: 100%;
    height: 100%;
    border-radius: 50%;
    background: linear-gradient(135deg, #38bdf8, #0ea5e9);
    display: flex;
    align-items: center;
    justify-content: center;
    color: #0a0f1c;
    font-size: 3em;
    font-weight: bold;
    text-transform: uppercase;
    position: absolute;
    top: 0;
    left: 0;
    z-index: 1;
  }

  .avatar-controls {
    display: flex;
    flex-direction: column;
    gap: 12px;
    margin-bottom: 15px;
  }

  .control-group {
    display: flex;
    justify-content: space-between;
    align-items: center;
  }

  .control-group label {
    color: #cbd5e1;
    font-weight: 500;
    font-size: 0.9rem;
  }

  .upload-area {
    border: 2px dashed #334155;
    border-radius: 10px;
    padding: 30px 15px;
    text-align: center;
    cursor: pointer;
    transition: all 0.3s ease;
    margin-bottom: 15px;
    background: #1e2a44;
  }

  .upload-area:hover {
    border-color: #38bdf8;
    background: rgba(56, 189, 248, 0.05);
  }

  .upload-area i {
    font-size: 36px;
    color: #38bdf8;
    margin-bottom: 10px;
  }

  .ai-suggestion {
    margin-top: 15px;
    padding-top: 15px;
    border-top: 1px solid #334155;
  }

  .suggestion-grid {
    display: grid;
    grid-template-columns: repeat(2, 1fr);
    gap: 8px;
    margin-top: 10px;
  }

  .suggestion-item {
    cursor: pointer;
    border-radius: 8px;
    overflow: hidden;
    transition: transform 0.3s ease;
    background: #1e2a44;
    padding: 8px;
    text-align: center;
  }

  .suggestion-item:hover {
    transform: scale(1.05);
    border: 1px solid #38bdf8;
  }

  /* Interests Section - Mobile Optimized */
  .interests-counter {
    text-align: center;
    margin: 12px 0;
    font-size: 1rem;
    color: #38bdf8;
    font-weight: bold;
  }

  .smart-suggestions,
  .trending-interests {
    margin-bottom: 20px;
    padding: 15px;
    background: #1e2a44;
    border-radius: 10px;
    border: 1px solid rgba(56, 189, 248, 0.2);
  }

  .smart-suggestions h4,
  .trending-interests h4 {
    margin-bottom: 12px;
    color: #38bdf8;
    font-size: 1.1rem;
  }

  .suggested-interests,
  .trending-tags {
    display: flex;
    flex-wrap: wrap;
    gap: 8px;
  }

  .interests-grid-container {
    background: #1e2a44;
    border-radius: 10px;
    padding: 15px;
    border: 1px solid rgba(56, 189, 248, 0.2);
  }

  .search-box {
    position: relative;
    margin-bottom: 15px;
  }

  .search-box i {
    position: absolute;
    left: 15px;
    top: 50%;
    transform: translateY(-50%);
    color: #88a0c7;
  }

  .search-box input {
    width: 100%;
    padding: 12px 12px 12px 45px;
    background: #152238;
    border: 2px solid #334155;
    border-radius: 8px;
    color: #e2e8f0;
    font-size: 16px;
    box-sizing: border-box;
  }

  .interests-grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(140px, 1fr));
    gap: 10px;
    max-height: 300px;
    overflow-y: auto;
    padding: 10px;
    background: #152238;
    border-radius: 8px;
  }

  .interest-checkbox {
    cursor: pointer;
  }

  .interest-checkbox input {
    display: none;
  }

  .interest-tag {
    display: block;
    padding: 12px 15px;
    background: #152238;
    border: 2px solid #334155;
    border-radius: 25px;
    text-align: center;
    transition: all 0.3s ease;
    color: #88a0c7;
    font-size: 0.9rem;
    min-height: 44px;
    display: flex;
    align-items: center;
    justify-content: center;
  }

  .interest-checkbox input:checked + .interest-tag {
    background: #38bdf8;
    border-color: #38bdf8;
    color: #0a0f1c;
    transform: scale(1.05);
  }

  /* Preview Section - Mobile Optimized */
  .preview-section {
    display: flex;
    flex-direction: column;
    gap: 25px;
  }

  .profile-preview {
    background: #1e2a44;
    border-radius: 12px;
    padding: 20px;
    border: 1px solid rgba(56, 189, 248, 0.2);
  }

  .preview-header {
    display: flex;
    flex-direction: column;
    gap: 15px;
    margin-bottom: 20px;
    text-align: center;
  }

  .preview-avatar {
    position: relative;
    width: 80px;
    height: 80px;
    margin: 0 auto;
  }

  .preview-avatar img {
    width: 100%;
    height: 100%;
    border-radius: 50%;
    object-fit: cover;
    border: 3px solid #38bdf8;
  }

  .preview-info h3 {
    margin: 0 0 5px 0;
    color: #e2e8f0;
    font-size: 1.3rem;
  }

  .preview-username {
    color: #38bdf8;
    margin: 0 0 8px 0;
  }

  .preview-bio {
    color: #88a0c7;
    margin: 10px 0;
    line-height: 1.5;
    font-size: 0.95rem;
  }

  .preview-stats {
    display: flex;
    gap: 15px;
    margin-top: 12px;
    justify-content: center;
  }

  .preview-interests {
    display: flex;
    flex-wrap: wrap;
    gap: 6px;
    margin: 15px 0;
  }

  .compatibility-preview {
    text-align: center;
    padding: 15px;
    background: #152238;
    border-radius: 10px;
    border: 1px solid rgba(56, 189, 248, 0.2);
  }

  .score-circle {
    width: 80px;
    height: 80px;
    border-radius: 50%;
    background: conic-gradient(#38bdf8 0% 85%, #1e2a44 85% 100%);
    display: flex;
    align-items: center;
    justify-content: center;
    margin: 0 auto 12px;
    position: relative;
  }

  .score-circle::before {
    content: "";
    position: absolute;
    width: 64px;
    height: 64px;
    background: #1e2a44;
    border-radius: 50%;
  }

  .score-circle span {
    position: relative;
    z-index: 1;
    font-weight: bold;
    color: #e2e8f0;
    font-size: 1rem;
  }

  .setup-complete {
    text-align: center;
    padding: 30px 15px;
    background: linear-gradient(135deg, #152238, #0a0f1c);
    border-radius: 12px;
    border: 2px solid #0ea5e9;
  }

  .completion-animation i {
    font-size: 48px;
    color: #0ea5e9;
    margin-bottom: 15px;
    animation: bounce 1s ease infinite;
  }

  /* Step Actions - Mobile Optimized */
  .step-actions {
    display: flex;
    flex-direction: column;
    gap: 12px;
    margin-top: 30px;
    padding-top: 20px;
    border-top: 1px solid rgba(56, 189, 248, 0.2);
  }

  /* Button Styles - Mobile Optimized */
  .btn-primary,
  .btn-secondary {
    padding: 14px 20px;
    border-radius: 10px;
    font-weight: 600;
    font-size: 1rem;
    cursor: pointer;
    transition: all 0.3s ease;
    border: none;
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 8px;
    min-height: 50px;
    text-align: center;
  }

  .btn-primary {
    background: linear-gradient(135deg, #38bdf8, #0ea5e9);
    color: #0a0f1c;
  }

  .btn-primary:hover {
    transform: translateY(-2px);
    box-shadow: 0 4px 12px rgba(56, 189, 248, 0.3);
  }

  .btn-secondary {
    background: #1e2a44;
    color: #cbd5e1;
    border: 2px solid #334155;
  }

  .btn-secondary:hover {
    border-color: #38bdf8;
    color: #e2e8f0;
  }

  /* Modal Styles */
  .modal {
    display: none;
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: rgba(10, 15, 28, 0.95);
    z-index: 1000;
    align-items: center;
    justify-content: center;
  }

  .tour-modal {
    max-width: 90%;
    background: #152238;
    border: 1px solid rgba(56, 189, 248, 0.2);
    border-radius: 15px;
    padding: 0;
    overflow: hidden;
  }

  .tour-step {
    display: none;
    text-align: center;
    padding: 30px 25px;
  }

  .tour-step.active {
    display: block;
    animation: fadeIn 0.5s ease;
  }

  .tour-step h3 {
    color: #38bdf8;
    margin-bottom: 15px;
    font-size: 1.5rem;
  }

  .tour-step p {
    color: #88a0c7;
    line-height: 1.6;
    margin-bottom: 25px;
  }

  .tour-actions {
    display: flex;
    gap: 12px;
    justify-content: center;
  }

  .tour-actions button {
    min-width: 100px;
  }

  /* Animations */
  @keyframes fadeInUp {
    from {
      opacity: 0;
      transform: translateY(30px);
    }
    to {
      opacity: 1;
      transform: translateY(0);
    }
  }

  @keyframes fadeIn {
    from {
      opacity: 0;
    }
    to {
      opacity: 1;
    }
  }

  @keyframes bounce {
    0%,
    20%,
    50%,
    80%,
    100% {
      transform: translateY(0);
    }
    40% {
      transform: translateY(-10px);
    }
    60% {
      transform: translateY(-5px);
    }
  }

  /* Tablet and Desktop Styles */
  @media (min-width: 768px) {
    .setup-container {
      padding: 20px;
    }

    .progress-steps {
      flex-wrap: nowrap;
    }

    .step {
      font-size: 0.9rem;
    }

    .setup-content {
      padding: 30px;
    }

    .setup-title {
      font-size: 2.2rem;
    }

    .form-grid {
      grid-template-columns: 1fr 1fr;
      display: grid;
    }

    .avatar-options {
      grid-template-columns: 1fr 1fr;
      display: grid;
    }

    .avatar-preview {
      width: 180px;
      height: 180px;
    }

    .avatar-initials-fallback {
      font-size: 3.5em;
    }

    .suggestion-grid {
      grid-template-columns: repeat(3, 1fr);
    }

    .preview-section {
      grid-template-columns: 1fr 1fr;
      display: grid;
    }

    .preview-header {
      flex-direction: row;
      text-align: left;
    }

    .preview-avatar {
      width: 100px;
      height: 100px;
      margin: 0;
    }

    .interests-grid {
      grid-template-columns: repeat(auto-fill, minmax(160px, 1fr));
    }

    .step-actions {
      flex-direction: row;
      justify-content: space-between;
    }

    .tour-modal {
      max-width: 500px;
    }

    .tour-step {
      padding: 40px 35px;
    }
  }

  @media (min-width: 1024px) {
    .setup-container {
      padding: 30px;
    }

    .setup-title {
      font-size: 2.5rem;
    }

    .avatar-preview {
      width: 200px;
      height: 200px;
    }

    .avatar-controls {
      flex-direction: row;
      justify-content: space-around;
    }

    .interests-grid {
      grid-template-columns: repeat(auto-fill, minmax(180px, 1fr));
    }
  }

  .avatar-preview canvas {
    position: relative;
    z-index: 2;
    width: 100%;
    height: 100%;
    border-radius: 50%;
    display: block;
  }
</style>

<script>
  // Current step tracking
  let currentStep = 1;
  const totalSteps = 4;
  let currentTourStep = 1;

  // Initialize the setup
  document.addEventListener("DOMContentLoaded", function () {
    // Show guided tour immediately
    document.getElementById("guidedTour").style.display = "flex";
    
    // Initialize the main setup (but keep it hidden until tour completes)
    initializeSetup();
  });

  function initializeSetup() {
    // Generate initial avatar
    generateAvatar();

    // Load trending interests
    loadTrendingInterests();

    // Initialize character counter
    const bioTextarea = document.getElementById("bio");
    const charCount = document.getElementById("charCount");
    bioTextarea.addEventListener("input", function () {
      charCount.textContent = this.value.length;
    });

    // Initialize interest search
    const interestSearch = document.getElementById("interestSearch");
    interestSearch.addEventListener("input", filterInterests);
  }

  // Guided Tour Functions
  function nextTourStep() {
    document.getElementById(`tourStep${currentTourStep}`).classList.remove("active");
    currentTourStep++;
    document.getElementById(`tourStep${currentTourStep}`).classList.add("active");
  }

  function prevTourStep() {
    document.getElementById(`tourStep${currentTourStep}`).classList.remove("active");
    currentTourStep--;
    document.getElementById(`tourStep${currentTourStep}`).classList.add("active");
  }

  function completeTour() {
    // Hide the tour modal
    document.getElementById("guidedTour").style.display = "none";
    
    // Show the main setup content with animation
    const mainContent = document.getElementById("mainSetupContent");
    mainContent.style.display = "block";
    mainContent.style.animation = "fadeIn 0.5s ease";
    
    // Mark tour as completed
    localStorage.setItem("profileSetupTourCompleted", "true");
  }

  function skipTour() {
    // Hide the tour modal
    document.getElementById("guidedTour").style.display = "none";
    
    // Show the main setup content immediately
    document.getElementById("mainSetupContent").style.display = "block";
    
    // Mark tour as completed
    localStorage.setItem("profileSetupTourCompleted", "true");
  }

  // Step Navigation
  function nextStep() {
    if (currentStep < totalSteps) {
      // Validate current step before proceeding
      if (validateStep(currentStep)) {
        document.getElementById(`step${currentStep}`).classList.remove("active");
        currentStep++;
        document.getElementById(`step${currentStep}`).classList.add("active");
        updateProgressBar();
      }
    }
  }

  function prevStep() {
    if (currentStep > 1) {
      document.getElementById(`step${currentStep}`).classList.remove("active");
      currentStep--;
      document.getElementById(`step${currentStep}`).classList.add("active");
      updateProgressBar();
    }
  }

  function updateProgressBar() {
    const progressFill = document.getElementById("progressFill");
    const progressPercentage = (currentStep / totalSteps) * 100;
    progressFill.style.width = `${progressPercentage}%`;

    // Update step indicators
    document.querySelectorAll(".step").forEach((step, index) => {
      if (index + 1 <= currentStep) {
        step.classList.add("active");
      } else {
        step.classList.remove("active");
      }
    });
  }

  // Step Validation
  function validateStep(step) {
    switch (step) {
      case 1:
        return validateBasicInfo();
      case 2:
        return validateAvatar();
      case 3:
        return validateInterests();
      default:
        return true;
    }
  }

  function validateBasicInfo() {
    const displayName = document.getElementById("display_name").value.trim();
    const username = document.getElementById("username").value.trim();

    if (!displayName) {
      showFeedback("nameFeedback", "Please enter a display name", "error");
      return false;
    }

    if (!username) {
      showFeedback("usernameFeedback", "Please enter a username", "error");
      return false;
    }

    return true;
  }

  function validateAvatar() {
    // Avatar validation logic
    return true;
  }

  function validateInterests() {
    const selectedInterests = document.querySelectorAll(
      'input[name="interests"]:checked'
    ).length;
    const continueButton = document.getElementById("continueToPreview");

    if (selectedInterests >= 3) {
      continueButton.disabled = false;
      return true;
    } else {
      continueButton.disabled = true;
      return false;
    }
  }

  // Username Availability Check
  function checkUsernameAvailability() {
    const username = document.getElementById("username").value.trim();
    const feedback = document.getElementById("usernameFeedback");

    if (username.length < 3) {
      showFeedback(
        "usernameFeedback",
        "Username must be at least 3 characters",
        "error"
      );
      return;
    }

    // Simulate API call
    setTimeout(() => {
      const available = Math.random() > 0.3; // 70% chance of being available
      if (available) {
        showFeedback("usernameFeedback", "Username is available!", "success");
      } else {
        showFeedback(
          "usernameFeedback",
          "Username is already taken",
          "error"
        );
      }
    }, 500);
  }

  // Avatar Generation
  function generateAvatar() {
    const style = document.getElementById("avatarStyle").value;
    const bgColor = document.getElementById("avatarBgColor").value;
    const mood = document.getElementById("avatarMood").value;

    const canvas = document.getElementById("avatarCanvas");
    const ctx = canvas.getContext("2d");

    // Clear canvas
    ctx.clearRect(0, 0, canvas.width, canvas.height);

    // Draw background
    ctx.fillStyle = bgColor;
    ctx.fillRect(0, 0, canvas.width, canvas.height);

    // Simple avatar generation based on style
    ctx.fillStyle = "#ffffff";
    ctx.strokeStyle = "#000000";
    ctx.lineWidth = 2;

    switch (style) {
      case "adventurer":
        drawAdventurerAvatar(ctx, mood);
        break;
      case "pixel":
        drawPixelAvatar(ctx, mood);
        break;
      case "bottts":
        drawRobotAvatar(ctx, mood);
        break;
      case "identicon":
        drawAbstractAvatar(ctx, mood);
        break;
      case "avataaars":
        drawCartoonAvatar(ctx, mood);
        break;
    }

    // Update preview
    updatePreview();
  }

  function drawAdventurerAvatar(ctx, mood) {
    // Simple adventurer avatar
    ctx.fillStyle = "#8B4513"; // Brown hair
    ctx.fillRect(50, 30, 100, 80);

    ctx.fillStyle = "#FFE0BD"; // Skin
    ctx.fillRect(60, 50, 80, 60);

    // Eyes based on mood
    ctx.fillStyle = "#000000";
    if (mood === "happy") {
      ctx.fillRect(75, 70, 10, 5); // Happy eyes
      ctx.fillRect(115, 70, 10, 5);
    } else if (mood === "serious") {
      ctx.fillRect(75, 70, 10, 10); // Serious eyes
      ctx.fillRect(115, 70, 10, 10);
    } else {
      ctx.fillRect(75, 70, 10, 10); // Normal eyes
      ctx.fillRect(115, 70, 10, 10);
    }

    // Mouth based on mood
    if (mood === "happy") {
      ctx.beginPath();
      ctx.arc(100, 90, 15, 0, Math.PI);
      ctx.stroke();
    } else if (mood === "serious") {
      ctx.fillRect(90, 90, 20, 2);
    } else {
      ctx.fillRect(90, 90, 20, 5);
    }
  }

  function drawPixelAvatar(ctx, mood) {
    // Simple pixel art avatar
    const pixelSize = 10;
    ctx.fillStyle = "#FF6B6B";

    // Face
    for (let i = 0; i < 8; i++) {
      for (let j = 0; j < 8; j++) {
        if ((i > 1 && i < 6 && j > 1 && j < 6) || (i === 1 && j === 3)) {
          ctx.fillRect(60 + i * pixelSize, 40 + j * pixelSize, pixelSize, pixelSize);
        }
      }
    }
  }

  function drawRobotAvatar(ctx, mood) {
    // Simple robot avatar
    ctx.fillStyle = "#666666";
    ctx.fillRect(50, 40, 100, 80);

    ctx.fillStyle = "#00FF00"; // Green eyes
    ctx.fillRect(70, 60, 20, 20);
    ctx.fillRect(110, 60, 20, 20);

    // Mouth
    ctx.fillStyle = "#FF0000";
    ctx.fillRect(80, 90, 40, 5);
  }

  function drawAbstractAvatar(ctx, mood) {
    // Abstract geometric avatar
    ctx.fillStyle = "#FFD700";
    ctx.beginPath();
    ctx.arc(100, 80, 40, 0, Math.PI * 2);
    ctx.fill();

    ctx.fillStyle = "#FF4500";
    ctx.beginPath();
    ctx.moveTo(100, 40);
    ctx.lineTo(140, 120);
    ctx.lineTo(60, 120);
    ctx.closePath();
    ctx.fill();
  }

  function drawCartoonAvatar(ctx, mood) {
    // Simple cartoon avatar
    ctx.fillStyle = "#87CEEB"; // Blue face
    ctx.beginPath();
    ctx.arc(100, 80, 40, 0, Math.PI * 2);
    ctx.fill();

    // Eyes
    ctx.fillStyle = "#FFFFFF";
    ctx.beginPath();
    ctx.arc(85, 70, 8, 0, Math.PI * 2);
    ctx.arc(115, 70, 8, 0, Math.PI * 2);
    ctx.fill();

    ctx.fillStyle = "#000000";
    ctx.beginPath();
    ctx.arc(85, 70, 4, 0, Math.PI * 2);
    ctx.arc(115, 70, 4, 0, Math.PI * 2);
    ctx.fill();

    // Mouth
    ctx.strokeStyle = "#000000";
    ctx.beginPath();
    ctx.arc(100, 90, 15, 0.1 * Math.PI, 0.9 * Math.PI);
    ctx.stroke();
  }

  function useInitialsAvatar() {
    document.getElementById("avatarCanvas").style.display = "none";
    document.getElementById("avatarInitialsFallback").style.display = "flex";
    
    const displayName = document.getElementById("display_name").value.trim();
    const initials = displayName ? displayName.charAt(0).toUpperCase() : "U";
    document.getElementById("avatarInitials").textContent = initials;
    
    updatePreview();
  }

  // Interests Management
  function updateInterestsCount() {
    const selectedCount = document.querySelectorAll(
      'input[name="interests"]:checked'
    ).length;
    document.getElementById("selectedCount").textContent = selectedCount;
    document.getElementById("previewInterestsCount").textContent = selectedCount;

    // Update continue button state
    const continueButton = document.getElementById("continueToPreview");
    continueButton.disabled = selectedCount < 3;

    // Update preview
    updatePreview();
  }

  function filterInterests() {
    const searchTerm = document
      .getElementById("interestSearch")
      .value.toLowerCase();
    const interests = document.querySelectorAll(".interest-checkbox");

    interests.forEach((interest) => {
      const interestText = interest
        .querySelector(".interest-tag")
        .textContent.toLowerCase();
      if (interestText.includes(searchTerm)) {
        interest.style.display = "block";
      } else {
        interest.style.display = "none";
      }
    });
  }

  function loadTrendingInterests() {
    const trendingTags = document.getElementById("trendingTags");
    const trendingInterests = [
      "AI",
      "Blockchain",
      "VR/AR",
      "Cryptocurrency",
      "Digital Art",
      "Podcasts",
      "Startups",
    ];

    trendingTags.innerHTML = "";
    trendingInterests.forEach((interest) => {
      const tag = document.createElement("span");
      tag.className = "interest-tag";
      tag.textContent = interest;
      tag.style.cursor = "pointer";
      tag.onclick = function () {
        const checkbox = document.querySelector(
          `input[value="${interest}"]`
        );
        if (checkbox) {
          checkbox.checked = true;
          updateInterestsCount();
        }
      };
      trendingTags.appendChild(tag);
    });
  }

  // Preview Update
  function updatePreview() {
    // Update name and username
    const displayName = document.getElementById("display_name").value.trim();
    const username = document.getElementById("username").value.trim();
    const bio = document.getElementById("bio").value.trim();
    const age = document.getElementById("age").value;
    const gender = document.getElementById("gender").value;

    document.getElementById("previewName").textContent =
      displayName || "Display Name";
    document.getElementById("previewUsername").textContent =
      username ? `@${username}` : "@username";
    document.getElementById("previewBio").textContent =
      bio || "Bio will appear here...";
    document.getElementById("previewAge").textContent = age || "--";

    // Update avatar preview
    const canvas = document.getElementById("avatarCanvas");
    const initialsFallback = document.getElementById("avatarInitialsFallback");
    
    if (canvas.style.display !== "none") {
      document.getElementById("previewAvatar").style.display = "none";
      document.getElementById("previewAvatarInitials").style.display = "flex";
      // In a real implementation, you would convert canvas to image
    } else {
      document.getElementById("previewAvatar").style.display = "none";
      document.getElementById("previewAvatarInitials").style.display = "flex";
      const initials = displayName ? displayName.charAt(0).toUpperCase() : "U";
      document.getElementById("previewAvatarInitialsText").textContent = initials;
    }

    // Update interests preview
    const selectedInterests = Array.from(
      document.querySelectorAll('input[name="interests"]:checked')
    ).map((input) => input.value);

    const previewInterests = document.getElementById("previewInterests");
    previewInterests.innerHTML = "";

    selectedInterests.slice(0, 8).forEach((interest) => {
      const tag = document.createElement("span");
      tag.className = "interest-tag";
      tag.textContent = interest;
      previewInterests.appendChild(tag);
    });

    if (selectedInterests.length > 8) {
      const moreTag = document.createElement("span");
      moreTag.className = "interest-tag";
      moreTag.textContent = `+${selectedInterests.length - 8} more`;
      previewInterests.appendChild(moreTag);
    }

    // Update compatibility score
    const baseScore = 70;
    const interestBonus = Math.min(selectedInterests.length * 3, 15);
    const bioBonus = bio.length > 50 ? 10 : bio.length > 20 ? 5 : 0;
    const totalScore = baseScore + interestBonus + bioBonus;

    document.getElementById("compatibilityScore").textContent = `${totalScore}%`;

    const scoreCircle = document.querySelector(".score-circle");
    scoreCircle.style.background = `conic-gradient(#38bdf8 0% ${totalScore}%, #1e2a44 ${totalScore}% 100%)`;
  }

  // Form Submission
  document
    .getElementById("profileForm")
    .addEventListener("submit", function (e) {
      e.preventDefault();

      // Validate all steps
      if (!validateStep(1) || !validateStep(2) || !validateStep(3)) {
        alert("Please complete all required fields before submitting.");
        return;
      }

      // Show loading state
      const submitButton = document.querySelector(".btn-complete");
      const originalText = submitButton.innerHTML;
      submitButton.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Setting up your profile...';
      submitButton.disabled = true;

      // Simulate API call
      setTimeout(() => {
        // Redirect to success page
        window.location.href = "/success";
      }, 2000);
    });

  // Utility Functions
  function showFeedback(elementId, message, type) {
    const element = document.getElementById(elementId);
    element.textContent = message;
    element.style.color = type === "error" ? "#ef4444" : "#10b981";
  }

  // Close modal when clicking outside
  window.onclick = function (event) {
    const modal = document.getElementById("guidedTour");
    if (event.target === modal) {
      skipTour();
    }
  };
</script>
{% endblock %}
